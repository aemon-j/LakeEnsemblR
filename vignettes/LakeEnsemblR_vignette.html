<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="johannes.feldbauer@tu-dresden.de" />
<meta name="author" content="tadhg.moore@dkit.ie" />
<meta name="author" content="jorrit.mesman@unige.ch" />
<meta name="author" content="ladwigjena@gmail.com" />

<meta name="date" content="2020-04-25" />

<title>R package LakeEnsemblR: Basic Use and Sample Applications</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">R package LakeEnsemblR: Basic Use and Sample Applications</h1>
<h4 class="author"><a href="mailto:johannes.feldbauer@tu-dresden.de" class="email">johannes.feldbauer@tu-dresden.de</a></h4>
<h4 class="author"><a href="mailto:tadhg.moore@dkit.ie" class="email">tadhg.moore@dkit.ie</a></h4>
<h4 class="author"><a href="mailto:jorrit.mesman@unige.ch" class="email">jorrit.mesman@unige.ch</a></h4>
<h4 class="author"><a href="mailto:ladwigjena@gmail.com" class="email">ladwigjena@gmail.com</a></h4>
<h4 class="date">2020-04-25</h4>


<div id="TOC">
<ul>
<li><a href="#included-models"><span class="toc-section-number">1</span> Included models</a></li>
<li><a href="#introduction"><span class="toc-section-number">2</span> Introduction</a></li>
<li><a href="#installation"><span class="toc-section-number">3</span> Installation</a></li>
<li><a href="#the-lakeensemblr-configuration-file"><span class="toc-section-number">4</span> The LakeEnsemblR configuration file</a><ul>
<li><a href="#location"><span class="toc-section-number">4.1</span> Location</a></li>
<li><a href="#time"><span class="toc-section-number">4.2</span> Time</a></li>
<li><a href="#config-files"><span class="toc-section-number">4.3</span> Config files</a></li>
<li><a href="#light"><span class="toc-section-number">4.4</span> Light</a></li>
<li><a href="#observations"><span class="toc-section-number">4.5</span> Observations</a></li>
<li><a href="#input"><span class="toc-section-number">4.6</span> Input</a></li>
<li><a href="#inflows"><span class="toc-section-number">4.7</span> Inflows</a></li>
<li><a href="#output"><span class="toc-section-number">4.8</span> Output</a></li>
<li><a href="#biogeochemistry"><span class="toc-section-number">4.9</span> Biogeochemistry</a></li>
<li><a href="#model-parameters"><span class="toc-section-number">4.10</span> Model parameters</a></li>
<li><a href="#calibration"><span class="toc-section-number">4.11</span> Calibration</a></li>
</ul></li>
<li><a href="#workflow"><span class="toc-section-number">5</span> Workflow</a><ul>
<li><a href="#setting-up-a-directory"><span class="toc-section-number">5.1</span> Setting up a directory</a></li>
<li><a href="#export_config"><span class="toc-section-number">5.2</span> Export_config</a></li>
<li><a href="#optional-changes-in-model-specific-directories"><span class="toc-section-number">5.3</span> Optional: changes in model-specific directories</a></li>
<li><a href="#run_ensemble"><span class="toc-section-number">5.4</span> Run_ensemble</a></li>
<li><a href="#post-processing"><span class="toc-section-number">5.5</span> Post-processing</a></li>
<li><a href="#example-model-run"><span class="toc-section-number">5.6</span> Example model run</a></li>
</ul></li>
<li><a href="#citation"><span class="toc-section-number">6</span> Citation</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<!-- ALTERNATIVE FOR html
rmarkdown::pdf_document:
    includes:
      in_header: preamble-latex.tex
    number_sections: yes
    toc: yes
    toc_depth: 3
-->
<div id="included-models" class="section level1">
<h1><span class="header-section-number">1</span> Included models</h1>
<p>LakeEnsemblR currently includes the following models: GLM (<span class="citation">Hipsey et al. (2019)</span>), FLake (<span class="citation">Mironov (2008)</span>), GOTM (<span class="citation">Umlauf, Bolding, and Burchard (2005)</span>), Simstrat (<span class="citation">Goudsmit et al. (2002)</span>), and MyLake (<span class="citation">Saloranta and Andersen (2007)</span>).</p>
</div>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">2</span> Introduction</h1>
<p>LakeEnsemblR is an R package that lets you run multiple one-dimensional physical lake models.</p>
<p>The settings for a model run are controlled by one centralised, “master” configuration file in YAML format. In this configuration file, you can set all the specifications for your model run, including start and end time, time steps, links to meteorological forcing and bathymetry files, etc. The package then converts these settings to the configuration files required by each model, through the <code>export_config</code> function. This sets up all models to run with the settings specified by the user, and the models are then run through the <code>run_ensemble</code> function. A netcdf file is created with the outputs of all the models, and the package provides functions to extract and plot this data.</p>
<p>Part of the design philosophy of LakeEnsemblR is that all input is given in a standardized format. This entails standard column names (which includes units), comma-separated ASCII files, and a DateTime format using the international standard format (ISO 8601), which is <code>YYYY-mm-dd HH:MM:SS</code>, for example <code>2020-04-03 09:00:00</code>. In this document, we will explain what the required files are and in what format they need to be. We also advise you to look at the provided example files, and at the templates provided with the R package (to be found in <code>package/inst/extdata</code>, or extracted by the function get_template).</p>
</div>
<div id="installation" class="section level1">
<h1><span class="header-section-number">3</span> Installation</h1>
<p>The code of LakeEnsemblR is hosted on the AEMON-J Github page (<a href="https://github.com/aemon-j/LakeEnsemblR" class="uri">https://github.com/aemon-j/LakeEnsemblR</a>), and can be installed using the <code>devtools</code> package</p>
<pre><code>devtools::install_github(&quot;aemon-j/LakeEnsemblR)</code></pre>
<p>The package relies on multiple other packages that also need to be installed. Most notably, to run the multiple models, it requires the packages FLakeR, GLM3r, GOTMr, SimstratR, and MyLakeR. These packages run the individual models, and contain ways of running the models for the platforms Windows, MacOS, or UNIX, through either executables, or by having the model code in R.</p>
</div>
<div id="the-lakeensemblr-configuration-file" class="section level1">
<h1><span class="header-section-number">4</span> The LakeEnsemblR configuration file</h1>
<p>In this section, we go through the LakeEnsemblR configuration file. This file controls the settings with which the models are run. It is written in YAML (Yaml Ain’t Markup Language) format, and can be opened by text-editors such as Notepad or Notepad++. Although not needed to use LakeEnsemblR, you can read this file into R with the <code>configr</code> package (<code>read.config</code> function). Within LakeEnsemblR, we provide the <code>get_yaml_value</code> and <code>input_yaml</code> functions to get and input values into this file type.</p>
<p>There is an example LakeEnsemblR configuration file provided in the example dataset in the package (<code>LakeEnsemblR::get_template(&quot;LakeEnsemblR_config&quot;)</code>) or you can download a copy from GitHub <a href="https://github.com/aemon-j/LakeEnsemblR/blob/master/inst/extdata/feeagh/Feeagh_master_config.yaml">here</a>.</p>
<div id="location" class="section level2">
<h2><span class="header-section-number">4.1</span> Location</h2>
<p>The first section is “Location”. Here you specify the name, latitude and longitude, elevation, maximum depth, and initial depth.</p>
<p>You also need to provide a link to the hypsograph (i.e. surface area per depth) file. As in the rest of the configuration file, all links to files are relative to the <code>folder</code> argument in the LakeEnsemblR functions (default is the R working directory). We strongly advise to set the working directory to the location of the LER config file, and link to the files relative to this directory (we explain this further in the chapter “Workflow” of this vignette). For example, if your hypsograph file is called <code>hypsograph.csv</code> and in the same folder as the LER config file, the corresponding line in the LER config file would look like</p>
<pre><code>  hypsograph: hypsograph.csv</code></pre>
<p>The data needs to be a comma-separated file (.csv) where 0m is the surface and all depths are reported as positive, in meters. Area needs to be in meters squared. The column names <em>must</em> be <code>Depth_meter</code> and <code>Area_meterSquared</code></p>
<p>Example of data:</p>
<pre><code>Depth_meter,Area_meterSquared
0,3931000
1,3688025
2,3445050
3,3336093.492
4,3225992.455
5,3133491.11
6,3029720
...</code></pre>
</div>
<div id="time" class="section level2">
<h2><span class="header-section-number">4.2</span> Time</h2>
<p>In the “Time” section, you fill in the start and end date of the simulation, and the model time step. <code>time_step</code> indicates the model integration time step, so each time step that the model performs a calculation.</p>
</div>
<div id="config-files" class="section level2">
<h2><span class="header-section-number">4.3</span> Config files</h2>
<p>In this section, you link to the model-specific configuration files. Templates of these can be found in in the package (<code>get_template(&quot;FLake_config&quot;)</code>, <code>get_template(&quot;GLM_config&quot;)</code>, etc.) or you can download a copy from GitHub <a href="https://github.com/aemon-j/LakeEnsemblR/blob/master/inst/extdata">here</a>. The setup of LakeEnsemblR is such that you will usually not have to access these files, as most settings are regulated through the LER “master” config file. However, should you want to change some of the more specialised settings in each model, that is possible.</p>
</div>
<div id="light" class="section level2">
<h2><span class="header-section-number">4.4</span> Light</h2>
<p>Here you can either give a value for Kw (light extinction coefficient) in 1/m, or give the link to a file, where you can vary Kw over time (template available).</p>
</div>
<div id="observations" class="section level2">
<h2><span class="header-section-number">4.5</span> Observations</h2>
<p>If you have observations of water temperature or ice cover, you can fill them in here. These will be used in plotting, and in case of water temperature potentially in initialising the temperature profile at the start of the simulation (but see next section).</p>
<p>For water temperature, the data needs to be a comma separated values (.csv) file where the datetime column is in the format <code>YYYY-mm-dd HH:MM:SS</code>. Depths are positive and relative to the water surface. Water temperature is in degrees Celsius. The column names <em>must</em> be <code>datetime</code>, <code>Depth_meter</code> and <code>Water_Temperature_celsius</code> (templates available).</p>
<p>Example of data:</p>
<pre><code>datetime,Depth_meter,Water_Temperature_celsius
2004-01-05 00:00:00,0.9,6.97
2004-01-05 00:00:00,2.5,6.71
2004-01-05 00:00:00,5,6.73
2004-01-05 00:00:00,8,6.76
...</code></pre>
</div>
<div id="input" class="section level2">
<h2><span class="header-section-number">4.6</span> Input</h2>
<p>In the “Input” section, you give information about the initial temperature profile, meteorological forcing, and ice.</p>
<p>Firstly, you can give the initial temperature profile with which to start the simulation (link to .csv file, template available). If you leave it empty, the water temperature observations will be used, provided you have an observation on the starting time of your simulation.</p>
<p>Secondly, you give the link to the file with your meteorological data. The data needs to be a comma separated values (.csv) file where the datetime column is in the format <code>YYYY-mm-dd HH:MM:SS</code>. See table 1 for the list of variables, units and column names. The time_zone setting has not been implemented yet.</p>
<p>Table 1. Description of meteorological variables used within LakeEnsemblR with units and required column names.</p>
<table>
<colgroup>
<col width="13%"></col>
<col width="3%"></col>
<col width="20%"></col>
<col width="62%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Description</th>
<th>Units</th>
<th>Column Name</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Downwelling longwave radaiation</td>
<td>W/m2</td>
<td>Longwave_Radiation_Downwelling_wattPerMeterSquared</td>
<td>If not provided,it is calculated internally from air temperature, cloud cover and relative humidity/dewpoint temperature</td>
</tr>
<tr class="even">
<td>Downwelling shortwave radaiation</td>
<td>W/m2</td>
<td>Shortwave_Radiation_Downwelling_wattPerMeterSquared</td>
<td>Required</td>
</tr>
<tr class="odd">
<td>Cloud cover</td>
<td>-</td>
<td>Cloud_Cover_decimalFraction</td>
<td>If not provided,it is calculated internally from air temperature, short-wave radiation, latitude, longitude, elevation and relative humidity/dewpoint temperature</td>
</tr>
<tr class="even">
<td>Air temperature</td>
<td>°C</td>
<td>Air_Temperature_celsius</td>
<td>Required</td>
</tr>
<tr class="odd">
<td>Relative humidity</td>
<td>%</td>
<td>Relative_Humidity_percent</td>
<td>If not provided,it is calculated internally from air temperature and dewpoint temperature</td>
</tr>
<tr class="even">
<td>Dewpoint temperature</td>
<td>°C</td>
<td>Dewpoint_Temperature_celsius</td>
<td>If not provided,it is calculated internally from air temperature and relative humidity</td>
</tr>
<tr class="odd">
<td>Wind speed at 10m</td>
<td>m/s</td>
<td>Ten_Meter_Elevation_Wind_Speed_meterPerSecond</td>
<td>Either wind speed or u and v vectors is required</td>
</tr>
<tr class="even">
<td>Wind direction at 10m</td>
<td>°C</td>
<td>Ten_Meter_Elevation_Wind_Direction_degree</td>
<td>Not required, but if provided u and v vectors are calculated internally</td>
</tr>
<tr class="odd">
<td>Wind u-vector at 10m</td>
<td>m/s</td>
<td>Ten_Meter_Uwind_vector_meterPerSecond</td>
<td>Either wind speed or u and v vectors is required</td>
</tr>
<tr class="even">
<td>Wind v-vector at 10m</td>
<td>m/s</td>
<td>Ten_Meter_Vwind_vector_meterPerSecond</td>
<td>Either wind speed or u and v vectors is required</td>
</tr>
<tr class="odd">
<td>Precipitation</td>
<td>m/s</td>
<td>Precipitation_meterPerSecond</td>
<td>Not strictly required but is important for mass budgets in some models</td>
</tr>
<tr class="even">
<td>Rainfall</td>
<td>m/s</td>
<td>Rainfall_meterPerSecond</td>
<td>Required</td>
</tr>
<tr class="odd">
<td>Snowfall</td>
<td>m/day</td>
<td>Snowfall_meterPerDay</td>
<td>If not provided,it is calculated internally from rain when air temperature &lt; 0 degC</td>
</tr>
<tr class="even">
<td>Sea level pressure</td>
<td>Pa</td>
<td>Sea_Level_Barometric_Pressure_pascal</td>
<td>Not required</td>
</tr>
<tr class="odd">
<td>Surface level pressure</td>
<td>Pa</td>
<td>Surface_Level_Barometric_Pressure_pascal</td>
<td>Required</td>
</tr>
<tr class="even">
<td>Vapour pressure</td>
<td>mbar</td>
<td>Vapor_Pressure_milliBar</td>
<td>If not provided,it is calculated internally from air temperature and relative humidity/dewpoint temperature</td>
</tr>
</tbody>
</table>
<p>Lastly, you can specify if you want to use the ice modules that are present in some of the models.</p>
</div>
<div id="inflows" class="section level2">
<h2><span class="header-section-number">4.7</span> Inflows</h2>
<p>Specify if you want to add inflows to your simulation. If yes, you need to link to a file with the inflow data. The data needs to be a comma separated values (.csv) file where the datetime column is in the format <code>YYYY-mm-dd HH:MM:SS</code>. Flow discharge, water temperature, and salinity need to be specified. The column names <em>must</em> be <code>datetime</code>, <code>Flow_metersCubedPerSecond</code>, <code>Water_Temperature_celsius</code>, and <code>Salinity_practicalSalinityUnits</code> (template available).</p>
<p>Example of data:</p>
<pre><code>datetime,Flow_metersCubedPerSecond,Water_Temperature_celsius,Salinity_practicalSalinityUnits
2005-01-01 00:00:00,5.62,6.96,0.00
2005-01-02 00:00:00,2.32,6.00,0.00
2005-01-03 00:00:00,1.77,8.44,0.00
2005-01-04 00:00:00,4.64,7.27,0.00
...</code></pre>
</div>
<div id="output" class="section level2">
<h2><span class="header-section-number">4.8</span> Output</h2>
<p>In the “Output” section, you specify how the output should look like. Currently, only the netcdf option is in place. You can specify the depth interval of the output, and the frequency. Also specify what variables should be in the output (currently only “temp” and “ice_height”).</p>
</div>
<div id="biogeochemistry" class="section level2">
<h2><span class="header-section-number">4.9</span> Biogeochemistry</h2>
<p>Currently not implemented</p>
</div>
<div id="model-parameters" class="section level2">
<h2><span class="header-section-number">4.10</span> Model parameters</h2>
<p>All models in LakeEnsemblR have different parameterizations. In this section, you can set the value of any parameter in one of the model-specific configuration files.</p>
<p>You can give either only the name of the parameter, but if needed you can also provide the name of the section in which the parameter occurs, separated by a <code>/</code>. For example for GOTM’s k_min parameter:</p>
<pre><code>  GOTM:
    k_min: 3.6E-6</code></pre>
<p>or:</p>
<pre><code>  GOTM:
    turb_param/k_min: 3.6E-6</code></pre>
</div>
<div id="calibration" class="section level2">
<h2><span class="header-section-number">4.11</span> Calibration</h2>
<p>This section is used when calibrating the models. In the package, the run_LHC (Latin-Hypercube) and run_MCMC (Monte-Carlo Markov Chain) functions do this, but this is currently still in a beta-phase and this will be more clearly explained in a later version of this vignette.</p>
</div>
</div>
<div id="workflow" class="section level1">
<h1><span class="header-section-number">5</span> Workflow</h1>
<p>In this chapter, we quickly show you how your workflow with LakeEnsemblR could look like.</p>
<div id="setting-up-a-directory" class="section level2">
<h2><span class="header-section-number">5.1</span> Setting up a directory</h2>
<p>First, you make an empty directory for the simulations of a specific lake. In this directory, you place the LakeEnsemblR configuration file, and the necessary LakeEnsemblR-format input files (e.g. meteorology, inflow, water temperature observations, hypsograph). Within this directory, you create empty folders for each model (FLake, GLM, GOTM, Simstrat, MyLake), and in here you place the model-specific configuration files, corresponding the information you put in the <code>config_files</code> section in the LER config file.</p>
</div>
<div id="export_config" class="section level2">
<h2><span class="header-section-number">5.2</span> Export_config</h2>
<p>Then, you run the <code>export_config</code> function, which exports the settings in the LER configuration file to the model-specific configuration files. It is possible to run parts of this function, such as <code>export_meteo</code>, if the meteorological forcing is the only thing you changed, but usually you will run <code>export_config</code>.</p>
</div>
<div id="optional-changes-in-model-specific-directories" class="section level2">
<h2><span class="header-section-number">5.3</span> Optional: changes in model-specific directories</h2>
<p>Optionally, you can now go into the model-specific configuration files and make further changes. This should not be needed for regular simulations, especially since you can control parameters in the <code>model_parameters</code> section of the LER config file, but the option is there. For example, if you want to change the depth of the inflow in the Simstrat model, you could go to the Simstrat folders and make these changes manually (or through a script you wrote). It speaks for itself that these changes should be done only if you are sure this is what you need, and LakeEnsemblR does not provide further support for this.</p>
</div>
<div id="run_ensemble" class="section level2">
<h2><span class="header-section-number">5.4</span> Run_ensemble</h2>
<p>The next step would be to call <code>run_ensemble</code>, which runs all the models. A new folder called “output” is created, in which a netcdf-file will be put with all the results from the model runs. If you are interested, each model sub-folder will also have an “output” folder, with the model-specific model output.</p>
</div>
<div id="post-processing" class="section level2">
<h2><span class="header-section-number">5.5</span> Post-processing</h2>
<p>Now that the model simulations are finished, you can extract the data with <code>load_var</code>, or plot it with <code>plot_ensemble</code>. You can extract data from the netcdf file to do any further analysis. The <code>ncdf4</code> R package supports working with netcdf data in R, and the PyNcView software (<a href="https://sourceforge.net/projects/pyncview/" class="uri">https://sourceforge.net/projects/pyncview/</a>) can be used to look at netcdf output.</p>
<p>We are currently working on a function to add new simulations (for example with a different meteorology file) to the same netcdf and including them in the analysis.</p>
</div>
<div id="example-model-run" class="section level2">
<h2><span class="header-section-number">5.6</span> Example model run</h2>
<p>See below for an example run, and some post-processing of the data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co"># Install packages - Ensure all packages are up to date - parallel development ongoing</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#install.packages(&quot;devtools&quot;)</span></a>
<a class="sourceLine" id="cb8-3" title="3">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;GLEON/GLM3r&quot;</span>)</a>
<a class="sourceLine" id="cb8-4" title="4">devtools<span class="op">::</span><span class="kw">install_github</span>(‘USGS<span class="op">-</span>R<span class="op">/</span>glmtools’, <span class="dt">ref =</span> ‘ggplot_overhaul’)</a>
<a class="sourceLine" id="cb8-5" title="5">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;aemon-j/FLakeR&quot;</span>, <span class="dt">ref =</span> “inflow”)</a>
<a class="sourceLine" id="cb8-6" title="6">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;aemon-j/GOTMr&quot;</span>)</a>
<a class="sourceLine" id="cb8-7" title="7">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;aemon-j/gotmtools&quot;</span>)</a>
<a class="sourceLine" id="cb8-8" title="8">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;aemon-j/SimstratR&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" title="9">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;aemon-j/LakeEnsemblR&quot;</span>)</a>
<a class="sourceLine" id="cb8-10" title="10">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;aemon-j/MyLakeR&quot;</span>)</a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co"># Load libraries</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="kw">library</span>(gotmtools)</a>
<a class="sourceLine" id="cb8-14" title="14"><span class="kw">library</span>(LakeEnsemblR)</a>
<a class="sourceLine" id="cb8-15" title="15"></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co"># Set working directory with example data from Lough Feeagh, Ireland</span></a>
<a class="sourceLine" id="cb8-17" title="17">template_folder &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata/feeagh&quot;</span>, <span class="dt">package=</span> <span class="st">&quot;LakeEnsemblR&quot;</span>)</a>
<a class="sourceLine" id="cb8-18" title="18"><span class="kw">dir.create</span>(<span class="st">&quot;example&quot;</span>) <span class="co"># Create example folder</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="kw">file.copy</span>(<span class="dt">from =</span> template_folder, <span class="dt">to =</span> <span class="st">&quot;example&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-20" title="20"><span class="kw">setwd</span>(<span class="st">&quot;example/feeagh&quot;</span>) <span class="co"># Change working directory to example folder</span></a>
<a class="sourceLine" id="cb8-21" title="21"></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="co"># Set models &amp; config file</span></a>
<a class="sourceLine" id="cb8-23" title="23">model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;GLM&quot;</span>,  <span class="st">&quot;FLake&quot;</span>, <span class="st">&quot;GOTM&quot;</span>, <span class="st">&quot;Simstrat&quot;</span>, <span class="st">&quot;MyLake&quot;</span>)</a>
<a class="sourceLine" id="cb8-24" title="24">config_file &lt;-<span class="st"> &quot;Feeagh_master_config.yaml&quot;</span></a>
<a class="sourceLine" id="cb8-25" title="25"></a>
<a class="sourceLine" id="cb8-26" title="26"><span class="co"># 1. Example - creates directories with all model setup</span></a>
<a class="sourceLine" id="cb8-27" title="27"><span class="kw">export_config</span>(<span class="dt">config_file =</span> config_file, <span class="dt">model =</span> model, <span class="dt">folder =</span> <span class="st">&quot;.&quot;</span>)</a>
<a class="sourceLine" id="cb8-28" title="28"></a>
<a class="sourceLine" id="cb8-29" title="29"><span class="co"># 2. Create meteo driver files</span></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="kw">export_meteo</span>(<span class="dt">config_file =</span> config_file, <span class="dt">model =</span> model)</a>
<a class="sourceLine" id="cb8-31" title="31"></a>
<a class="sourceLine" id="cb8-32" title="32"><span class="co"># 3. Create initial conditions</span></a>
<a class="sourceLine" id="cb8-33" title="33">start_date &lt;-<span class="st"> </span><span class="kw">get_yaml_value</span>(<span class="dt">file =</span> config_file, <span class="dt">label =</span>  <span class="st">&quot;time&quot;</span>, <span class="dt">key =</span> <span class="st">&quot;start&quot;</span>)</a>
<a class="sourceLine" id="cb8-34" title="34"></a>
<a class="sourceLine" id="cb8-35" title="35"><span class="kw">export_init_cond</span>(<span class="dt">config_file =</span> config_file, </a>
<a class="sourceLine" id="cb8-36" title="36">                 <span class="dt">model =</span> model,</a>
<a class="sourceLine" id="cb8-37" title="37">                 <span class="dt">date =</span> start_date,</a>
<a class="sourceLine" id="cb8-38" title="38">                 <span class="dt">print =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb8-39" title="39"></a>
<a class="sourceLine" id="cb8-40" title="40"><span class="co"># 4. Run ensemble lake models</span></a>
<a class="sourceLine" id="cb8-41" title="41">wtemp_list &lt;-<span class="st"> </span><span class="kw">run_ensemble</span>(<span class="dt">config_file =</span> config_file,</a>
<a class="sourceLine" id="cb8-42" title="42">                           <span class="dt">model =</span> <span class="kw">c</span>(<span class="st">&quot;FLake&quot;</span>, <span class="st">&quot;GLM&quot;</span>, <span class="st">&quot;GOTM&quot;</span>, <span class="st">&quot;Simstrat&quot;</span>, <span class="st">&quot;MyLake&quot;</span>),</a>
<a class="sourceLine" id="cb8-43" title="43">                           <span class="dt">return_list =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Post-processing:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Load libraries for post-processing</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">library</span>(ggpubr)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">## Plot model output using gotmtools/ggplot2</span></a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="co"># Extract names of all the variables in netCDF</span></a>
<a class="sourceLine" id="cb9-8" title="8">ens_out &lt;-<span class="st"> &quot;output/ensemble_output.nc&quot;</span></a>
<a class="sourceLine" id="cb9-9" title="9">vars &lt;-<span class="st"> </span>gotmtools<span class="op">::</span><span class="kw">list_vars</span>(ens_out)</a>
<a class="sourceLine" id="cb9-10" title="10">vars <span class="co"># Print variables</span></a>
<a class="sourceLine" id="cb9-11" title="11"></a>
<a class="sourceLine" id="cb9-12" title="12">plist &lt;-<span class="st"> </span><span class="kw">list</span>() <span class="co"># Initialize empty list for storing plots of each variable</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</a>
<a class="sourceLine" id="cb9-14" title="14">  p1 &lt;-<span class="st"> </span>gotmtools<span class="op">::</span><span class="kw">plot_vari</span>(<span class="dt">ncdf =</span> ens_out,</a>
<a class="sourceLine" id="cb9-15" title="15">                             <span class="dt">var =</span> vars[i],</a>
<a class="sourceLine" id="cb9-16" title="16">                             <span class="dt">incl_time =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb9-17" title="17">                             <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">25</span>),</a>
<a class="sourceLine" id="cb9-18" title="18">                             <span class="dt">zlab =</span> <span class="st">&quot;degC&quot;</span>)</a>
<a class="sourceLine" id="cb9-19" title="19">  p1 &lt;-<span class="st"> </span>p1 <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_reverse</span>() <span class="op">+</span><span class="st"> </span><span class="co">#Reverse y-axis</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">45</span>,<span class="dv">0</span>))<span class="op">+</span><span class="st"> </span><span class="co"># ggplot2 v3.3 is sensitive to order of ylim</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="st">    </span><span class="kw">ggtitle</span>(vars[i]) <span class="op">+</span><span class="st"> </span><span class="co"># Add title using variable name</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;&quot;</span>)<span class="op">+</span><span class="st"> </span><span class="co"># Remove x-label</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="st">    </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">18</span>) <span class="co"># Increase font size of plots</span></a>
<a class="sourceLine" id="cb9-24" title="24">  plist[[i]] &lt;-<span class="st"> </span>p1</a>
<a class="sourceLine" id="cb9-25" title="25">}</a>
<a class="sourceLine" id="cb9-26" title="26"></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co"># Plot all model simulations</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co"># install.packages(&quot;ggpubr&quot;)</span></a>
<a class="sourceLine" id="cb9-29" title="29">g1 &lt;-<span class="st"> </span>ggpubr<span class="op">::</span><span class="kw">ggarrange</span>(<span class="dt">plotlist =</span> plist, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">common.legend =</span> <span class="ot">TRUE</span>, <span class="dt">legend =</span> <span class="st">&quot;right&quot;</span>)</a>
<a class="sourceLine" id="cb9-30" title="30">g1</a>
<a class="sourceLine" id="cb9-31" title="31"><span class="kw">ggsave</span>(<span class="st">&quot;output/model_ensemble_watertemp.png&quot;</span>, g1,  <span class="dt">dpi =</span> <span class="dv">300</span>,<span class="dt">width =</span> <span class="dv">384</span>,<span class="dt">height =</span> <span class="dv">300</span>, <span class="dt">units =</span> <span class="st">&quot;mm&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="citation" class="section level1">
<h1><span class="header-section-number">6</span> Citation</h1>
<p>See</p>
<pre><code>citation(&quot;LakeEnsemblR&quot;)</code></pre>
<p>on how to cite this project.</p>
<p>Although this information is included when running the function above, we would like to repeat that in case you use and cite LakeEnsemblR, you will also need to cite the individual models that you used in your simulations.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-goudsmit_application_2002">
<p>Goudsmit, G.-H., H. Burchard, F. Peeters, and A. Wüest. 2002. “Application of <span class="math inline">\(k-\epsilon\)</span> Turbulence Models to Enclosed Basins: The Role of Internal Seiches.” <em>Journal of Geophysical Research: Oceans</em> 107 (C12): 23–21–23–13. <a href="https://doi.org/10.1029/2001JC000954">https://doi.org/10.1029/2001JC000954</a>.</p>
</div>
<div id="ref-hipsey_general_2019">
<p>Hipsey, M. R., L. C. Bruce, C. Boon, B. Busch, C. C. Carey, D. P. Hamilton, P. C. Hanson, et al. 2019. “A General Lake Model (GLM 3.0) for Linking with High-Frequency Sensor Data from the Global Lake Ecological Observatory Network (GLEON).” <em>Geoscientific Model Development</em> 12 (1): 473–523. <a href="https://doi.org/10.5194/gmd-12-473-2019">https://doi.org/10.5194/gmd-12-473-2019</a>.</p>
</div>
<div id="ref-mironov_flake_2008">
<p>Mironov, Dimitrii V. 2008. <em>Parameterization of Lakes in Numerical Weather Prediction. Description of a Lake Model</em>. COSMO Technical Report. Offenbach am Main, Germany: Deutscher Wetterdienst. <a href="http://www.flake.igb-berlin.de/site/doc">http://www.flake.igb-berlin.de/site/doc</a>.</p>
</div>
<div id="ref-saloranta_mylakemulti_year_2007">
<p>Saloranta, Tuomo M., and Tom Andersen. 2007. “MyLake—A Multi-Year Lake Simulation Model Code Suitable for Uncertainty and Sensitivity Analysis Simulations.” <em>Ecological Modelling</em>, Uncertainty in Ecological Models, 207 (1): 45–60. <a href="https://doi.org/10.1016/j.ecolmodel.2007.03.018">https://doi.org/10.1016/j.ecolmodel.2007.03.018</a>.</p>
</div>
<div id="ref-umlauf_gotm_2005">
<p>Umlauf, Lars, Karsten Bolding, and Hans Burchard. 2005. <em>GOTM – Scientific Documentation</em> (version 3.2). Marine Science Reports. Warnemuende, Germany: Leibniz-Institute for Baltic Sea Research. <a href="https://gotm.net/portfolio/documentation/">https://gotm.net/portfolio/documentation/</a>.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

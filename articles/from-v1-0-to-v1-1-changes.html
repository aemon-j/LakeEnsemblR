<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>From v1.0 to v1.1 changes • LakeEnsemblR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="From v1.0 to v1.1 changes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LakeEnsemblR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Get started</h6></li>
    <li><a class="dropdown-item" href="../articles/lakeensemblr-overview.html">LakeEnsemblR: Basic Use and Sample Applications</a></li>
    <li><a class="dropdown-item" href="../articles/setting-up-lakeensemblr.html">Setting up LakeEnsemblR</a></li>
    <li><a class="dropdown-item" href="../articles/running-lakeensemblr.html">Running LakeEnsemblR</a></li>
    <li><a class="dropdown-item" href="../articles/running-lakeensemblr-in-parallel.html">Running LakeEnsemblR in parallel</a></li>
    <li><a class="dropdown-item" href="../articles/post-processing-lakeensemblr.html">Post-processing LakeEnsemblR</a></li>
    <li><a class="dropdown-item" href="../articles/calibrating-lakeensemblr.html">Calibrating LakeEnsemblR</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Installation</h6></li>
    <li><a class="dropdown-item" href="../articles/docker.html">Docker</a></li>
    <li><a class="dropdown-item" href="../articles/installation-issues.html">Installation issues</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/what-is-a-netcdf-file.html">What is a NetCDF file</a></li>
    <li><a class="dropdown-item" href="../articles/lake-models.html">Lake Models</a></li>
    <li><a class="dropdown-item" href="../articles/package-structure.html">Package structure</a></li>
    <li><a class="dropdown-item" href="../articles/from-v1-0-to-v1-1-changes.html">From v1.0 to v1.1 changes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aemon-j/LakeEnsemblR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>From v1.0 to v1.1 changes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/aemon-j/LakeEnsemblR/blob/main/vignettes/articles/from-v1-0-to-v1-1-changes.Rmd" class="external-link"><code>vignettes/articles/from-v1-0-to-v1-1-changes.Rmd</code></a></small>
      <div class="d-none name"><code>from-v1-0-to-v1-1-changes.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="version-1-1">Version 1.1<a class="anchor" aria-label="anchor" href="#version-1-1"></a>
</h2>
<p>In March 2022, we updated LakeEnsemblR to version 1.1. The main
advantage of this new version is the possibility to use multiple inflows
and outflows at specified depths in your simulated lake or reservoir.
Moreover, these inflows and outflows no longer have to balance each
other out, and in the models that support this (Simstrat, GLM, GOTM) you
can therefore now also simulate varying water levels. Simstrat has been
updated to a later version (v3.0.1) and there have been other bug fixes
as well, for example regarding plotting heatmaps in lakes with varying
water level, or in the YAML-parser functions.</p>
<p>However, some of these improvements required a change in the
configuration file, which may cause unexpected errors when updating
LakeEnsemblR to v1.1. Here we describe how to avoid or fix these
problems, and we also give instructions on how you can keep working with
v1.0, if you prefer this.</p>
<p>As a general advice, please first reinstall the latest versions of
the model-specific packages (GLM3r, SimstratR, etc.) after updating
LakeEnsemblR. Also, new example test cases and configuration files are
provided in LakeEnsemblR, the model-specific packages, and at the <a href="https://github.com/aemon-j/LER_examples" class="external-link">LER_examples Github
page</a>. The advice below is therefore mostly if you want to adapt your
existing setup to v1.1.</p>
<div class="section level3">
<h3 id="changes-in-the-lakeensemblr-configuration-file">Changes in the LakeEnsemblR configuration file<a class="anchor" aria-label="anchor" href="#changes-in-the-lakeensemblr-configuration-file"></a>
</h3>
<div class="section level5">
<h5 id="inflows-and-outflows-sections">inflows and outflows sections<a class="anchor" aria-label="anchor" href="#inflows-and-outflows-sections"></a>
</h5>
<p>In v1.0, there was a single <em>inflows</em> section, but now inflows
and outflows are split into two sections.</p>
<ul>
<li>“use”: Each section has the “use” argument; if set to “false”, no
inflows or outflows are used and the rest of the section is not
read.</li>
<li>“file”: If use = true, provide the file where inflow discharge,
temperature, and salinity, or outflow discharge are provided. Note that
multiple flows can be provided in this file, by adding the suffixes
“_1”, “_2”, “_3”, etc. See <code>get_template(“Inflow”)</code> for an
example inflow file with two inflows, or
<code>get_template(“Outflow”)</code> for an example outflow file with a
single outflow.</li>
<li>“number_inflows” and “number_outflows”: The number of inflows or
outflows to use.</li>
<li>“outflow_lvl” (<em>outflows</em>-only): The height of the outflows,
relative to the deepest point in the lake. If the outflow is a surface
outflow use “-1”. If there are more than one outflow in the outflow
file, this must be a list with one value per outflow, e.g.:</li>
</ul>
<pre><code><span><span class="va">outflow_lvl</span><span class="op">:</span></span>
<span>  <span class="op">-</span> <span class="op">-</span><span class="fl">1</span></span>
<span>  <span class="op">-</span> <span class="fl">10</span></span></code></pre>
<ul>
<li>Inflows are always assumed to be surface inflows.</li>
<li>“fix_wlvl” (<em>inflows</em>-only and optional): If set to “true”,
the water level in GOTM will be fixed to the initial water level. This
reproduces v1.0 behaviour. However, note that this means that the water
balance is no longer correctly resolved in GOTM. If this argument is
absent, it is assumed to be “false”.</li>
</ul>
<p>Note that the “mass_balance” argument from v1.0 is no longer used. If
you want to recreate the situation of v1.0 where inflow = outflow, you
can just provide the same file name in the “file” argument of both the
inflows and outflows section. Also the “scale_param” parameter from the
v1.0 <em>inflows</em> section has been (re)moved (see next
paragraph).</p>
</div>
<div class="section level4">
<h4 id="inflow-and-outflow-scaling-factors">Inflow and outflow scaling factors<a class="anchor" aria-label="anchor" href="#inflow-and-outflow-scaling-factors"></a>
</h4>
<p>If you want to scale the discharge in your inflows or outflows (for
example if your measured streamflow only accounts for part of the
catchment runoff), you need to put this in the <em>scaling_factors</em>
section. It’s important to note that you need to provide multiple
scaling factors if you have multiple inflows or outflows, in a
list-format. As with other scaling factors, model-specific scaling
factors overwrite generic (“all”) scaling factors. Here is an example
for a reservoir with a single inflow and two outflows, in which the
first (surface) outflow in Simstrat has a 10% higher discharge:</p>
<pre><code><span><span class="va">scaling_factors</span><span class="op">:</span></span>
<span>   <span class="va">all</span><span class="op">:</span></span>
<span>      <span class="va">inflow</span><span class="op">:</span> <span class="fl">1.0</span></span>
<span>      <span class="va">outflow</span><span class="op">:</span></span>
<span>      <span class="op">-</span> <span class="fl">1.0</span></span>
<span>      <span class="op">-</span> <span class="fl">1.0</span></span>
<span>   <span class="va">Simstrat</span><span class="op">:</span></span>
<span>      <span class="va">outflow</span><span class="op">:</span></span>
<span>      <span class="op">-</span> <span class="fl">1.1</span></span>
<span>      <span class="op">-</span> <span class="fl">1.0</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="the-output-section">The <strong>output</strong> section<a class="anchor" aria-label="anchor" href="#the-output-section"></a>
</h4>
<p>This section has remained largely the same, but with two small
updates. The most important one is that “w_level” is now a potential
output of the models, to be listed under “variables”. Note that for
MyLake and FLake, this is set to <code>NA</code>, because these models
do not simulate water level, although you can assume water level in
these models to be equal to the model parameters <code>In.Z</code>
and<code>depth_w_lk</code>, respectively.</p>
<p>A second update is that you can provide “max_members”, which is the
maximum number of members that you can add to the same netcdf file using
the <code>add = TRUE</code> argument in <code><a href="../reference/run_ensemble.html">run_ensemble()</a></code>. If
it is not provided, it is assumed to be 25.</p>
</div>
</div>
<div class="section level3">
<h3 id="changes-in-the-simstrat-configuration-file">Changes in the Simstrat configuration file<a class="anchor" aria-label="anchor" href="#changes-in-the-simstrat-configuration-file"></a>
</h3>
<p>A new version of Simstrat is being used (v3.0.1), which included some
changes in the names of parameters. The easiest solution to this problem
will be to remove your simstrat.par file and run export_config() again,
which will create a new file based on the template in SimstratR. If you
want to make the changes manually: * p_albedo -&gt; p_sw_ice * p_sw
-&gt; p_sw_water * InflowPlacement -&gt; InflowMode. However, also the
options changed: Old 0 = New 1, Old 1 = New 2, New 0 = no inflows or
outflows used.</p>
</div>
<div class="section level3">
<h3 id="how-do-the-different-models-handle-the-water-balance">How do the different models handle the water balance?<a class="anchor" aria-label="anchor" href="#how-do-the-different-models-handle-the-water-balance"></a>
</h3>
<p>If you use inflows and outflows of different intensity and then look
at the “w_level” output of LakeEnsemblR, you will probably notice that
each model handles the water balance differently. Here we quickly
mention the differences. These differences are inherent to the models,
and LakeEnsemblR does not attempt to standardise this. However, if you
want to create a similar water level between the models, you could for
example change the scaling factors of the inflow or the outflow.</p>
<ul>
<li>FLake: There is no water balance, as only the heat transferred by
the inflow is added to the model. w_level output is therefore “NA”.</li>
<li>GLM: <strong>water balance = delta-discharge + precipitation +
evaporation + overflow</strong>
</li>
<li>GOTM: <strong>water balance = delta-discharge + precipitation +
evaporation</strong>
</li>
<li>Simstrat: <strong>water balance = delta-discharge +
overflow</strong>
</li>
<li>MyLake: Outflow discharge is assumed to be equal to the inflow
discharge, and no other flows are computed. w_level output is therefore
“NA”.</li>
</ul>
<p>With “overflow” we mean that if the water level exceeds the highest
level in the hypsograph, the excess water is removed from the model.</p>
<p>In GOTM, there are also other options of computing the water balance,
for example by forcing the water level to a prescribed time series.
These options are not supported by LakeEnsemblR, but can still be used
by accessing the gotm.yaml file.</p>
</div>
<div class="section level3">
<h3 id="what-if-i-want-to-keep-working-with-v1-0">What if I want to keep working with v1.0?<a class="anchor" aria-label="anchor" href="#what-if-i-want-to-keep-working-with-v1-0"></a>
</h3>
<p>Perhaps you have already set up LakeEnsemblR v1.0 in your lake or
reservoir, and you don’t want this update to affect your simulations.
Because LakeEnsemblR and the model-specific packages have been attached
to a specific “release” in GitHub, you can still install these old
versions. These are the versions that are described in the publication
Moore et al. (2021), and you will still be able to use your old
workflow.</p>
<pre><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/LakeEnsemblR@v1.0.0"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/FLakeR@LakeEnsemblR_v1.0.0"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/GLM3r@LakeEnsemblR_v1.0.0"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/GOTMr@LakeEnsemblR_v1.0.0"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/SimstratR@LakeEnsemblR_v1.0.0"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/MyLakeR@LakeEnsemblR_v1.0.0"</span><span class="op">)</span></span></code></pre>
<p>To access the LER_examples corresponding to v1.0 of LakeEnsemblR,
download <a href="https://github.com/aemon-j/LER_examples/releases/tag/v1.0.0" class="external-link">this
zip file</a>.</p>
<p>Alternatively, you can install v1.1 and the new model-specific
packages, change your configuration file as described above, set the
outflow file to the same file as the inflow file, and “fix_wlvl” to
“true”. This should result in very similar behaviour compared to v1.0
(although a later version of the Simstrat model will be used).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tadhg Moore, Robert Ladwig, Johannes Feldbauer, Jorrit Mesman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>

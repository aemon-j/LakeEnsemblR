<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>LakeEnsemblR: Basic Use and Sample Applications • LakeEnsemblR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="LakeEnsemblR: Basic Use and Sample Applications">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LakeEnsemblR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Get started</h6></li>
    <li><a class="dropdown-item" href="../articles/lakeensemblr-overview.html">LakeEnsemblR: Basic Use and Sample Applications</a></li>
    <li><a class="dropdown-item" href="../articles/setting-up-lakeensemblr.html">Setting up LakeEnsemblR</a></li>
    <li><a class="dropdown-item" href="../articles/running-lakeensemblr.html">Running LakeEnsemblR</a></li>
    <li><a class="dropdown-item" href="../articles/running-lakeensemblr-in-parallel.html">Running LakeEnsemblR in parallel</a></li>
    <li><a class="dropdown-item" href="../articles/post-processing-lakeensemblr.html">Post-processing LakeEnsemblR</a></li>
    <li><a class="dropdown-item" href="../articles/calibrating-lakeensemblr.html">Calibrating LakeEnsemblR</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Installation</h6></li>
    <li><a class="dropdown-item" href="../articles/docker.html">Docker</a></li>
    <li><a class="dropdown-item" href="../articles/installation-issues.html">Installation issues</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Other</h6></li>
    <li><a class="dropdown-item" href="../articles/what-is-a-netcdf-file.html">What is a NetCDF file</a></li>
    <li><a class="dropdown-item" href="../articles/lake-models.html">Lake Models</a></li>
    <li><a class="dropdown-item" href="../articles/package-structure.html">Package structure</a></li>
    <li><a class="dropdown-item" href="../articles/from-v1-0-to-v1-1-changes.html">From v1.0 to v1.1 changes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aemon-j/LakeEnsemblR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="lakeensemblr-overview_files/kePrint-0.0.1/kePrint.js"></script><link href="lakeensemblr-overview_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>LakeEnsemblR: Basic Use and Sample Applications</h1>
                        <h4 data-toc-skip class="author"><a href="mailto:johannes.feldbauer@tu-dresden.de" class="email">johannes.feldbauer@tu-dresden.de</a></h4>
                        <h4 data-toc-skip class="author"><a href="mailto:tadhg.moore@dkit.ie" class="email">tadhg.moore@dkit.ie</a></h4>
                        <h4 data-toc-skip class="author"><a href="mailto:jorrit.mesman@unige.ch" class="email">jorrit.mesman@unige.ch</a></h4>
                        <h4 data-toc-skip class="author"><a href="mailto:ladwigjena@gmail.com" class="email">ladwigjena@gmail.com</a></h4>
            
            <h4 data-toc-skip class="date">2025-10-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aemon-j/LakeEnsemblR/blob/main/vignettes/lakeensemblr-overview.Rmd" class="external-link"><code>vignettes/lakeensemblr-overview.Rmd</code></a></small>
      <div class="d-none name"><code>lakeensemblr-overview.Rmd</code></div>
    </div>

    
    
<!-- ALTERNATIVE FOR HTML
 rmarkdown::html_vignette: 
     number_sections: yes 
     toc: yes
     toc_depth: 3
-->
<!-- ALTERNATIVE FOR pdf
rmarkdown::pdf_document:
    includes:
      in_header: preamble-latex.tex
    number_sections: yes
    toc: yes
    toc_depth: 3
-->
<div class="section level2">
<h2 id="included-models">Included models<a class="anchor" aria-label="anchor" href="#included-models"></a>
</h2>
<p>LakeEnsemblR currently includes the following models: GLM (<span class="citation">Hipsey et al. (2019)</span>), FLake (<span class="citation">Mironov (2008)</span>), GOTM (<span class="citation">Umlauf, Bolding, and Burchard (2005)</span>), Simstrat
(<span class="citation">Goudsmit et al. (2002)</span>), and MyLake
(<span class="citation">Saloranta and Andersen (2007)</span>).</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>LakeEnsemblR is an R package that lets you run multiple
one-dimensional physical lake models.</p>
<p>The settings for a model run are controlled by one centralised,
“master” configuration file in <a href="https://yaml.org/" class="external-link">YAML</a>
format. In this configuration file, you can set all the specifications
for your model run, including start and end time, time steps, links to
meteorological forcing and bathymetry files, etc. The package then
converts these settings to the configuration files required by each
model, through the <code>export_config</code> function. This sets up all
models to run with the settings specified by the user, and the models
are then run through the <code>run_ensemble</code> function. A netcdf
file is created with the outputs of all the models, and the package
provides functions to extract and plot this data.</p>
<p>Part of the design philosophy of LakeEnsemblR is that all input is
given in a standardized format. This entails standard column names
(which includes units), comma-separated ASCII files, and a DateTime
format using the format <code>YYYY-mm-dd HH:MM:SS</code>, for example
<code>2020-04-03 09:00:00</code>. In this document, we will explain what
the required files are and in what format they need to be. We also
advise you to look at the provided example files, and at the templates
provided with the R package (to be found in
<code>package/inst/extdata</code>, or extracted by the function
<code>get_template</code>).</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The code of LakeEnsemblR is hosted on the AEMON-J Github page (<a href="https://github.com/aemon-j/LakeEnsemblR" class="external-link uri">https://github.com/aemon-j/LakeEnsemblR</a>), and can be
installed using the <code>devtools</code> package</p>
<pre><code>devtools::install_github("aemon-j/LakeEnsemblR)</code></pre>
<p>The package relies on multiple other packages that also need to be
installed. Most notably, to run the multiple models, it requires the
packages FLakeR, GLM3r, GOTMr, SimstratR, and MyLakeR. These packages
run the individual models, and contain ways of running the models for
the platforms Windows, MacOS, or Linux, through either executables, or
by having the model code in R.</p>
</div>
<div class="section level2">
<h2 id="the-lakeensemblr-configuration-file">The LakeEnsemblR configuration file<a class="anchor" aria-label="anchor" href="#the-lakeensemblr-configuration-file"></a>
</h2>
<p>In this section, we go through the LakeEnsemblR configuration file.
This file controls the settings with which the models are run. It is
written in <a href="https://yaml.org/" class="external-link">YAML</a> (Yaml Ain’t Markup
Language) format, and can be opened by text-editors such as Notepad or
Notepad++. Although not needed to use LakeEnsemblR, you can read this
file into R with the <code>configr</code> package
(<code>read.config</code> function). Within LakeEnsemblR, we provide the
<code>get_yaml_multiple</code> and <code>input_yaml_multiple</code>
functions to get and input values into this file type.</p>
<p>There is an LakeEnsemblR configuration file provided in the example
dataset in the package
(<code>LakeEnsemblR::get_template("LakeEnsemblR_config")</code>) or you
can download a copy from GitHub <a href="https://github.com/aemon-j/LakeEnsemblR/blob/main/inst/extdata/feeagh/LakeEnsemblR.yaml" class="external-link">here</a>.</p>
<div class="section level3">
<h3 id="location">Location<a class="anchor" aria-label="anchor" href="#location"></a>
</h3>
<p>The first section is “Location”. Here you specify the name, latitude
and longitude, elevation, maximum depth, and initial depth.</p>
<p>You also need to provide a link to the hypsograph (i.e. surface area
per depth) file. As in the rest of the configuration file, all links to
files are relative to the <code>folder</code> argument in the
LakeEnsemblR (from now on: LER) functions (default is the R working
directory). We strongly advise to set the working directory to the
location of the LER config file, and link to the files relative to this
directory (we explain this further in the chapter “Workflow” of this
vignette). For example, if your hypsograph file is called
<code>hypsograph.csv</code> and in the same folder as the LER config
file, the corresponding line in the LER config file would look like</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="at">  </span><span class="fu">hypsograph</span><span class="kw">:</span><span class="at"> hypsograph.csv</span></span></code></pre></div>
<p>The data needs to be a comma-separated file (.csv) where 0m is the
surface and all depths are reported as positive, in meters. Area needs
to be in meters squared. The column names <em>must</em> be
<code>Depth_meter</code> and <code>Area_meterSquared</code></p>
<p>Example of data:</p>
<pre class="csv"><code>Depth_meter,Area_meterSquared
0,3931000
1,3688025
2,3445050
3,3336093.492
4,3225992.455
5,3133491.11
6,3029720
...</code></pre>
</div>
<div class="section level3">
<h3 id="time">Time<a class="anchor" aria-label="anchor" href="#time"></a>
</h3>
<p>In the “Time” section, you fill in the start and end date of the
simulation, and the model time step. <code>time_step</code> indicates
the model integration time step, i.e. each time step that the model
performs a calculation.</p>
<p>LakeEnsemblR will work with any time zone, provided that the time
columns in all input files are in the same time zone and there are no
shifts from/to daylight saving time in the files. Of all models, only
GLM requires to know the time zone. In LakeEnsemblR this is
automatically set to UTC. However, this information is only used in
GLM’s <code>albedo_mode</code> 2 and 3, or when GLM’s
<code>rad_mode</code> is set to 5 (i.e. computing shortwave radiation if
this is not provided). In LakeEnsemblR, the default
<code>albedo_mode</code> is 1, and shortwave radiation must be provided,
so providing the timezone is not required. Yet if you are changing
<code>albedo_mode</code> to 2 or 3, make sure you enter your data in
UTC. GOTM also assumes the time to be in UTC, but this is only used when
computing shortwave radiation if it is not provided, which does not
happen when using LakeEnsemblR.</p>
</div>
<div class="section level3">
<h3 id="config-files">Config files<a class="anchor" aria-label="anchor" href="#config-files"></a>
</h3>
<p>In this section, you link to the model-specific configuration files.
Templates of these can be found in in the package
(<code>get_template("FLake_config")</code>,
<code>get_template("GLM_config")</code>, etc. all available templates
can be shown using <code><a href="../reference/get_template.html">get_template()</a></code>) or you can download a
copy from GitHub <a href="https://github.com/aemon-j/LakeEnsemblR/blob/main/inst/extdata" class="external-link">here</a>.
The setup of LakeEnsemblR is such that you will usually not have to
access these files, as most settings are regulated through the LER
“main” config file. However, should you want to change some of the more
specialised settings in each model, that is possible.</p>
</div>
<div class="section level3">
<h3 id="observations">Observations<a class="anchor" aria-label="anchor" href="#observations"></a>
</h3>
<p>If you have observations of water temperature, ice cover or water
level, you can fill them in here. These will be used in plotting, and in
case of water temperature potentially in initialising the temperature
profile at the start of the simulation (see next section).</p>
<p>For water temperature, the data needs to be a comma separated values
(.csv) file where the datetime column is in the format
<code>YYYY-mm-dd HH:MM:SS</code>. Depths are positive and relative to
the water surface. Water temperature is in degrees Celsius. The column
names <em>must</em> be <code>datetime</code>, <code>Depth_meter</code>
and <code>Water_Temperature_celsius</code> (templates available).</p>
<p>Example of data:</p>
<pre class="csv"><code>datetime,Depth_meter,Water_Temperature_celsius
2004-01-05 00:00:00,0.9,6.97
2004-01-06 00:00:00,2.5,6.71
2004-01-07 00:00:00,5,6.73
2004-01-08 00:00:00,8,6.76
...</code></pre>
<p>For ice height, the data must also be a comma separated values (.csv)
file, with datetime column in format <code>YYYY-mm-dd HH:MM:SS</code>
and has the column name <code>datetime</code>. Ice height must be
provided in meters and the column must be named
<code>Ice_Height_meter</code>.</p>
<p>Example of data:</p>
<pre class="csv"><code>datetime, Ice_Height_meter
2004-01-01 00:00:00,0.3
2004-01-02 00:00:00,0.3
2004-01-03 00:00:00,0.35
...</code></pre>
<p>For water level, the data must also be a comma seperated values
(.csv) file, with datetime column in format
<code>YYYY-mm-dd HH:MM:SS</code> and has the column name
<code>datetime</code>. Water level must be provided in meters above
ground and the column must be named <code>Water_Level_meter</code>.</p>
<p>Example of data:</p>
<pre class="csv"><code>datetime, Water_Level_meter
2004-01-01 00:00:00,45.4
2004-01-02 00:00:00,45.6
2004-01-03 00:00:00,45.7
...</code></pre>
</div>
<div class="section level3">
<h3 id="input">Input<a class="anchor" aria-label="anchor" href="#input"></a>
</h3>
<p>In the “Input” section, you give information about the initial
temperature profile, meteorological forcing, the light extinction
coefficient, and whether the ice modules should be used.</p>
<p>Firstly, you can give the initial temperature profile with which to
start the simulation (link to .csv file with headers
<code>Depth_meter, Water_Temperature_celsius</code>, template available
using <code>get_template("Initial temperature profile")</code>). If you
leave it empty, the water temperature observations will be used,
provided you have an observation on the starting time of your
simulation.</p>
<p>Secondly, you give the link to the file with your meteorological
data. The data needs to be a comma separated values (.csv) file where
the datetime column is in the format <code>YYYY-mm-dd HH:MM:SS</code>.
See Table 1 for the list of variables, units and column names. The
<code>time_zone</code> setting has not been implemented yet.</p>
<table class="table table" style="font-size: 11px; ">
<caption style="font-size: initial !important;">
Table 1. Description of meteorological variables used within
LakeEnsemblR with units and required column names.
</caption>
<thead><tr>
<th style="text-align:left;">
Description
</th>
<th style="text-align:left;">
Units
</th>
<th style="text-align:left;">
Column.Name
</th>
<th style="text-align:left;">
Status
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Downwelling longwave radiation
</td>
<td style="text-align:left;">
W/m2
</td>
<td style="text-align:left;">
Longwave_Radiation_Downwelling_wattPerMeterSquared
</td>
<td style="text-align:left;">
If not provided,it is calculated internally from air temperature, cloud
cover and relative humidity/dewpoint temperature
</td>
</tr>
<tr>
<td style="text-align:left;">
Downwelling shortwave radiation
</td>
<td style="text-align:left;">
W/m2
</td>
<td style="text-align:left;">
Shortwave_Radiation_Downwelling_wattPerMeterSquared
</td>
<td style="text-align:left;">
Required
</td>
</tr>
<tr>
<td style="text-align:left;">
Cloud cover
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
Cloud_Cover_decimalFraction
</td>
<td style="text-align:left;">
If not provided,it is calculated internally from air temperature,
short-wave radiation, latitude, longitude, elevation and relative
humidity/dewpoint temperature
</td>
</tr>
<tr>
<td style="text-align:left;">
Air temperature
</td>
<td style="text-align:left;">
°C
</td>
<td style="text-align:left;">
Air_Temperature_celsius
</td>
<td style="text-align:left;">
Required
</td>
</tr>
<tr>
<td style="text-align:left;">
Relative humidity
</td>
<td style="text-align:left;">
%
</td>
<td style="text-align:left;">
Relative_Humidity_percent
</td>
<td style="text-align:left;">
If not provided,it is calculated internally from air temperature and
dewpoint temperature
</td>
</tr>
<tr>
<td style="text-align:left;">
Dewpoint temperature
</td>
<td style="text-align:left;">
°C
</td>
<td style="text-align:left;">
Dewpoint_Temperature_celsius
</td>
<td style="text-align:left;">
If not provided,it is calculated internally from air temperature and
relative humidity
</td>
</tr>
<tr>
<td style="text-align:left;">
Wind speed at 10m
</td>
<td style="text-align:left;">
m/s
</td>
<td style="text-align:left;">
Ten_Meter_Elevation_Wind_Speed_meterPerSecond
</td>
<td style="text-align:left;">
Either wind speed or u and v vectors is required
</td>
</tr>
<tr>
<td style="text-align:left;">
Wind direction at 10m
</td>
<td style="text-align:left;">
°
</td>
<td style="text-align:left;">
Ten_Meter_Elevation_Wind_Direction_degree
</td>
<td style="text-align:left;">
Not required, but if provided u and v vectors are calculated internally
</td>
</tr>
<tr>
<td style="text-align:left;">
Wind u-vector at 10m
</td>
<td style="text-align:left;">
m/s
</td>
<td style="text-align:left;">
Ten_Meter_Uwind_vector_meterPerSecond
</td>
<td style="text-align:left;">
Either wind speed or u and v vectors is required
</td>
</tr>
<tr>
<td style="text-align:left;">
Wind v-vector at 10m
</td>
<td style="text-align:left;">
m/s
</td>
<td style="text-align:left;">
Ten_Meter_Vwind_vector_meterPerSecond
</td>
<td style="text-align:left;">
Either wind speed or u and v vectors is required
</td>
</tr>
<tr>
<td style="text-align:left;">
Precipitation
</td>
<td style="text-align:left;">
mm/day
</td>
<td style="text-align:left;">
Precipitation_millimeterPerDay
</td>
<td style="text-align:left;">
Not strictly required but is important for mass budgets in some models.
</td>
</tr>
<tr>
<td style="text-align:left;">
Precipitation
</td>
<td style="text-align:left;">
mm/hr
</td>
<td style="text-align:left;">
Precipitation_millimeterPerHour
</td>
<td style="text-align:left;">
Different unit option for precipitation.
</td>
</tr>
<tr>
<td style="text-align:left;">
Rainfall
</td>
<td style="text-align:left;">
mm/day
</td>
<td style="text-align:left;">
Rainfall_millimeterPerDay
</td>
<td style="text-align:left;">
If not provided,it is calculated internally from precipitation
</td>
</tr>
<tr>
<td style="text-align:left;">
Rainfall
</td>
<td style="text-align:left;">
mm/hr
</td>
<td style="text-align:left;">
Rainfall_millimeterPerHour
</td>
<td style="text-align:left;">
Different unit option for rainfall.
</td>
</tr>
<tr>
<td style="text-align:left;">
Snowfall
</td>
<td style="text-align:left;">
mm/day
</td>
<td style="text-align:left;">
Snowfall_millimeterPerDay
</td>
<td style="text-align:left;">
If not provided, it is calculated internally from rain or precipitation
when air temperature &lt; 0 degC
</td>
</tr>
<tr>
<td style="text-align:left;">
Snowfall
</td>
<td style="text-align:left;">
mm/hr
</td>
<td style="text-align:left;">
Snowfall_millimeterPerHour
</td>
<td style="text-align:left;">
Different unit option for snowfall.
</td>
</tr>
<tr>
<td style="text-align:left;">
Sea level pressure
</td>
<td style="text-align:left;">
Pa
</td>
<td style="text-align:left;">
Sea_Level_Barometric_Pressure_pascal
</td>
<td style="text-align:left;">
Not required
</td>
</tr>
<tr>
<td style="text-align:left;">
Surface level pressure
</td>
<td style="text-align:left;">
Pa
</td>
<td style="text-align:left;">
Surface_Level_Barometric_Pressure_pascal
</td>
<td style="text-align:left;">
Is calculated from sea level pressure if not provided
</td>
</tr>
<tr>
<td style="text-align:left;">
Vapour pressure
</td>
<td style="text-align:left;">
mbar
</td>
<td style="text-align:left;">
Vapour_Pressure_milliBar
</td>
<td style="text-align:left;">
If not provided,it is calculated internally from air temperature and
relative humidity/dewpoint temperature
</td>
</tr>
</tbody>
</table>
<p>Next you can either give a value for Kw (light extinction
coefficient) in 1/m, or give the link to a file, where you can vary Kw
over time (template available using
<code>get_template("Light extinction")</code>). The file must be a
comma-separated file (.csv) with the two columns <code>datetime</code>
and <code>Extinction_Coefficient_perMeter</code> containing the date in
the format (<code>YYYY-mm-dd HH:MM:SS</code>) and corresponding Kw value
in 1/m.</p>
<p>Lastly, you can specify if you want to use the ice modules that are
present in some of the models.</p>
</div>
<div class="section level3">
<h3 id="inflows">Inflows<a class="anchor" aria-label="anchor" href="#inflows"></a>
</h3>
<p>Specify if you want to add inflows to your simulation. If yes, you
need to link to a file with the inflow data. The data needs to be a
comma separated values (.csv) file where the datetime column is in the
format <code>YYYY-mm-dd HH:MM:SS</code>. Flow discharge, water
temperature, and salinity need to be specified. The column names
<em>must</em> be <code>datetime</code>,
<code>Flow_metersCubedPerSecond</code>,
<code>Water_Temperature_celsius</code>, and
<code>Salinity_practicalSalinityUnits</code> (template available using
<code>get_template("Inflow")</code> ). If you have multiple inflows, you
should add suffixes “_1”, “_2”, etc. The fix_wlvl argument lets you fix
the water level in the GOTM model, to reproduce the behaviour of an
earlier version of LakeEnsemblR.</p>
<p>Example of inflow data:</p>
<pre class="csv"><code>datetime,Flow_metersCubedPerSecond,Water_Temperature_celsius,Salinity_practicalSalinityUnits
2005-01-01 00:00:00,5.62,6.96,0.00
2005-01-02 00:00:00,2.32,6.00,0.00
2005-01-03 00:00:00,1.77,8.44,0.00
2005-01-04 00:00:00,4.64,7.27,0.00
...</code></pre>
</div>
<div class="section level3">
<h3 id="outflows">Outflows<a class="anchor" aria-label="anchor" href="#outflows"></a>
</h3>
<p>For the models that allow changing water level (at this moment GLM,
GOTM, Simstrat) outflows can be set in this section by setting
<code>use</code> to true. The outflow discharge must be provided in
daily resolution in a .csv file specified by <code>file</code>. The file
must contain a date column in <code>YYYY-mm-dd HH:MM:SS</code> format
called <code>datetime</code> and for every outflow (specified by
<code>number_outflows</code>) one column titled
<code>Flow_metersCubedPerSecond</code>, if more than one outflow are
defined the outflow columns need to be numbered like this:
<code>Flow_metersCubedPerSecond_1</code>,
<code>Flow_metersCubedPerSecond_2</code>. For each outflow the depth of
the outflow must be specified as height in meters above the lake bottom,
or if the outflow is a surface outflow it can be set to “-1”.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">outflows</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="at">   </span><span class="fu">use</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                                    # use outflows? [true/false]</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="at">   </span><span class="fu">file</span><span class="kw">:</span><span class="at"> LakeEnsemblR_outflow_standard.csv</span><span class="co">      # file with outflow data</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="at">   </span><span class="fu">number_outflows</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                           # number of outflows in the outflow file</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="at">   </span><span class="fu">outflow_lvl</span><span class="kw">:</span><span class="co">                                 # height of the outflow above the ground.</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="dv">-1</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="dv">15</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>In the “Output” section, you specify how the output should look like.
This can be “netcdf” or “text”, which will generate a series of csv
files in rLakeAnalyzer format. You can specify the depth interval of the
output, and the frequency. Also specify what variables should be in the
output (currently “temp”, “ice_height”, “salt”, “dens”, and
“w_level”).</p>
<!-- ## Biogeochemistry -->
<!-- Currently not implemented -->
</div>
<div class="section level3">
<h3 id="scaling-factors">Scaling factors<a class="anchor" aria-label="anchor" href="#scaling-factors"></a>
</h3>
<p>In the “Scaling factors” (scaling_factors) section scaling factors to
be applied to meteorological input as well as to inflows and outflows,
either for all models or model-specific can be defined. If the section
is not specified, no scaling is applied. Using “all” scaling factors
that should be applied to all models can be defined, otherwise model
specific scaling can be supplied by using the model name. If both “all”
and model-specific are specified for a certain model, only the
model-specific scaling is applied. If there are multiple inflows or
outflows a list of scaling parameters for each of them must be provided
(see example).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">scaling_factors</span><span class="kw">:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="at">   </span><span class="fu">all</span><span class="kw">:</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="at">      </span><span class="fu">wind_speed</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="at">      </span><span class="fu">swr</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.0</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="at">   </span><span class="fu">Simstrat</span><span class="kw">:</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="at">      </span><span class="fu">wind_speed</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.95</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="at">   </span><span class="fu">GLM</span><span class="kw">:</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="at">     </span><span class="fu">outflow</span><span class="kw">:</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fl">1.02</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fl">1.03</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-parameters">Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h3>
<p>All models in LakeEnsemblR have different parameterisations. In this
section, you can set the value of any parameter in one of the
model-specific configuration files.</p>
<p>You can give either only the name of the parameter, but if needed you
can also provide the name of the section in which the parameter occurs,
separated by a <code>/</code>. For example for GOTM’s k_min
parameter:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="at">  </span><span class="fu">GOTM</span><span class="kw">:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="at">    </span><span class="fu">k_min</span><span class="kw">:</span><span class="at"> </span><span class="fl">3.6E-6</span></span></code></pre></div>
<p>or:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="at">  </span><span class="fu">GOTM</span><span class="kw">:</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="at">    </span><span class="fu">turb_param/k_min</span><span class="kw">:</span><span class="at"> </span><span class="fl">3.6E-6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h3>
<p>This section is used when calibrating the models. In the package, the
<code>cali_ensemble</code> function runs the calibration. For all three
methods model specific parameters and scaling factors for the input
meteorological forcing can be calibrated. In any case the parameters to
be calibrated are definded in the master control .yaml file. The meteo
scalings are defined in the <code>met:</code> section and the model
specific parameters in sections with the corresponding model names
e.g. <code>MyLake:</code>. The meteo scaling names must be the short
names for the meteo variables, which are defined in the
<code>met_var_dic</code> data and can be inspected using
<code>print(met_var_dic)</code>. The model specific names must be the
parameter name as given in the model specific configuration file
(e.g. gotm.yaml) combined with the lowest section name in which the
parameter can be found and separated by a slash “/”
(e.g. turb_param/k_min). An example of how the calibration section could
look like is given below:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">calibration</span><span class="kw">:</span><span class="co">                                   # Calibration section                                   # Calibration section</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="at">   </span><span class="fu">met</span><span class="kw">:</span><span class="co">                                        # Meteo scaling parameter</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="at">      </span><span class="fu">wind_speed</span><span class="kw">:</span><span class="co">                              # Wind speed scaling</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span><span class="co">                            # lower bound for wind speed scaling        </span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                              # upper bound for wind speed scaling</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">                            # initial value for wind speed scaling</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                            # log transform scaling factor</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="at">      </span><span class="fu">swr</span><span class="kw">:</span><span class="co">                                     # shortwave radiation scaling</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span><span class="co">                            # lower bound for shortwave radiation scaling</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.5</span><span class="co">                            # upper bound for shortwave radiation scaling</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">                            # initial value for shortwave radiation scaling</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                            # log transform scaling factor</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="at">   </span><span class="fu">Simstrat</span><span class="kw">:</span><span class="co">                                # Simstrat specific parameters                                 </span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="at">      </span><span class="fu">a_seiche</span><span class="kw">:</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.0008</span><span class="co">                         # lower bound for parameter</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.003</span><span class="co">                          # upper bound for parameter</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.001</span><span class="co">                        # initial value for parameter</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                            # log transform scaling factor                          </span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="at">   </span><span class="fu">MyLake</span><span class="kw">:</span><span class="co">                                  # MyLake specific parameters                                    </span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="at">     </span><span class="fu">Phys.par/C_shelter</span><span class="kw">:</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="at">        </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.14</span><span class="co">                            # lower bound for parameter</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="at">        </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.16</span><span class="co">                            # upper bound for parameter</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="at">        </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.15</span><span class="co">                          # initial value for parameter</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="at">        </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                             # log transform scaling factor   </span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="at">   </span><span class="fu">GOTM</span><span class="kw">:</span><span class="co">                                    # GOTM specific parameters</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="at">      </span><span class="fu">turb_param/k_min</span><span class="kw">:</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">5E-4</span><span class="co">                           # lower bound for parameter</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">5E-6</span><span class="co">                           # upper bound for parameter</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">1E-5</span><span class="co">                         # initial value for parameter</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="at">   </span><span class="fu">GLM</span><span class="kw">:</span><span class="co">                               # GLM specific parameters</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="at">      </span><span class="fu">mixing/coef_mix_hyp</span><span class="kw">:</span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span><span class="co">                       # lower bound for parameter</span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                         # upper bound for parameter</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">                       # initial value for parameter</span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                       # log transform scaling factor</span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="at">   </span><span class="fu">FLake</span><span class="kw">:</span><span class="co">                             # FLake specific parameters</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a><span class="at">      </span><span class="fu">c_relax_C</span><span class="kw">:</span></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.00003</span><span class="co">                  # lower bound for parameter</span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span><span class="co">                      # upper bound for parameter</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.003</span><span class="co">                  # initial value for parameter</span></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                       # log transform scaling factor</span></span></code></pre></div>
<p>An example on how to run the calibration see section 5.7 “Model
calibration”.</p>
</div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>In this chapter, we quickly show you how your workflow with
LakeEnsemblR could look like.</p>
<div class="section level3">
<h3 id="setting-up-a-directory">Setting up a directory<a class="anchor" aria-label="anchor" href="#setting-up-a-directory"></a>
</h3>
<p>First, you make an empty directory for the simulations of a specific
lake. In this directory, you place the LakeEnsemblR configuration file,
and the necessary LakeEnsemblR-format input files (e.g. meteorology,
inflow, water temperature observations, hypsograph). Within this
directory, you create empty folders for each model (FLake, GLM, GOTM,
Simstrat, MyLake), and in here you place the model-specific
configuration files, corresponding the information you put in the
<code>config_files</code> section in the LER config file.</p>
</div>
<div class="section level3">
<h3 id="export_config">Export_config<a class="anchor" aria-label="anchor" href="#export_config"></a>
</h3>
<p>Then, you run the <code>export_config</code> function, which exports
the settings in the LER configuration file to the model-specific
configuration files. It is possible to run parts of this function, such
as <code>export_meteo</code>, if the meteorological forcing is the only
thing you changed, but usually you will run
<code>export_config</code>.</p>
</div>
<div class="section level3">
<h3 id="optional-changes-in-model-specific-directories">Optional: changes in model-specific directories<a class="anchor" aria-label="anchor" href="#optional-changes-in-model-specific-directories"></a>
</h3>
<p>Optionally, you can now go into the model-specific configuration
files and make further changes. This should not be needed for regular
simulations, especially since you can control parameters in the
<code>model_parameters</code> section of the LER config file, but the
option is there. For example, if you want to change the depth of the
inflow in the Simstrat model, you could go to the Simstrat folders and
make these changes manually (or through a script you wrote). It speaks
for itself that these changes should be done only if you are sure this
is what you need, and LakeEnsemblR does not provide further support for
this.</p>
</div>
<div class="section level3">
<h3 id="run_ensemble">Run_ensemble<a class="anchor" aria-label="anchor" href="#run_ensemble"></a>
</h3>
<p>The next step would be to call <code>run_ensemble</code>, which runs
all the models. A new folder called “output” is created, in which a
netcdf-file will be put with all the results from the model runs. If you
are interested, each model sub-folder will also have an “output” folder,
with the model-specific model output.</p>
</div>
<div class="section level3">
<h3 id="example-model-run">Example model run<a class="anchor" aria-label="anchor" href="#example-model-run"></a>
</h3>
<p>See below for an example run, and some post-processing of the
data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install packages - Ensure all packages are up to date</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/GLM3r"</span>, ref <span class="op">=</span> <span class="st">"v3.1.1"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"USGS-R/glmtools"</span>, ref <span class="op">=</span> <span class="st">"ggplot_overhaul"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/FLakeR"</span>, ref <span class="op">=</span> <span class="st">"inflow"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/GOTMr"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/gotmtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/SimstratR"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/MyLakeR"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"aemon-j/LakeEnsemblR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aemon-j/LakeEnsemblR" class="external-link">LakeEnsemblR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set working directory with example data from Lough Feeagh, Ireland</span></span>
<span><span class="va">template_folder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/feeagh"</span>, package<span class="op">=</span> <span class="st">"LakeEnsemblR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"example"</span><span class="op">)</span> <span class="co"># Create example folder</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">template_folder</span>, to <span class="op">=</span> <span class="st">"example"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"example/feeagh"</span><span class="op">)</span> <span class="co"># Change working directory to example folder</span></span>
<span></span>
<span><span class="co"># Set models &amp; config file</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GLM"</span>,  <span class="st">"FLake"</span>, <span class="st">"GOTM"</span>, <span class="st">"Simstrat"</span>, <span class="st">"MyLake"</span><span class="op">)</span></span>
<span><span class="va">config_file</span> <span class="op">&lt;-</span> <span class="st">"LakeEnsemblR.yaml"</span></span>
<span></span>
<span><span class="co"># 1. Example - creates directories with all model setup</span></span>
<span><span class="fu"><a href="../reference/export_config.html">export_config</a></span><span class="op">(</span>config_file <span class="op">=</span> <span class="va">config_file</span>, model <span class="op">=</span> <span class="va">model</span>, folder <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># 2. Run ensemble lake models</span></span>
<span><span class="va">wtemp_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_ensemble.html">run_ensemble</a></span><span class="op">(</span>config_file <span class="op">=</span> <span class="va">config_file</span>,</span>
<span>                           model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FLake"</span>, <span class="st">"GLM"</span>, <span class="st">"GOTM"</span>, <span class="st">"Simstrat"</span>, <span class="st">"MyLake"</span><span class="op">)</span>,</span>
<span>                           return_list <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the model outputs is very easy using the
<code><a href="../reference/plot_heatmap.html">plot_heatmap()</a></code> function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_heatmap.html">plot_heatmap</a></span><span class="op">(</span><span class="st">"output/ensemble_output.nc"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"output/model_ensemble_watertemp.png"</span>, <span class="va">g1</span>,  dpi <span class="op">=</span> <span class="fl">300</span>,width <span class="op">=</span> <span class="fl">384</span>,height <span class="op">=</span> <span class="fl">300</span>,</span>
<span>       units <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="post-processing">Post-processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h3>
<p>Once LakeEnsemblR did successfully run all lake models, you can
either extract the output data from the netcdf file for custom analysis
and plotting, or use post-processing scripts for an initial look at the
output.</p>
<div class="section level4">
<h4 id="quick-post-processing">Quick post-processing<a class="anchor" aria-label="anchor" href="#quick-post-processing"></a>
</h4>
<p>Now that the model simulations are finished, you can extract the data
with <code>load_var</code>, or plot it with <code>plot_ensemble</code>.
You can extract data from the netcdf file to do any further analysis.
The <code>ncdf4</code> R package supports working with netcdf data in R,
and the PyNcView software (<a href="https://sourceforge.net/projects/pyncview/" class="external-link uri">https://sourceforge.net/projects/pyncview/</a>) can be used
to look at netcdf output.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import the LER output into your workspace</span></span>
<span><span class="va">ens_out</span> <span class="op">&lt;-</span> <span class="st">"output/ensemble_output.nc"</span></span>
<span></span>
<span><span class="co"># Plot depth and time-specific results</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_ensemble.html">plot_ensemble</a></span><span class="op">(</span>ncdf <span class="op">=</span> <span class="va">ens_out</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FLake"</span>, <span class="st">"GLM"</span>,  <span class="st">"GOTM"</span>, <span class="st">"Simstrat"</span>, <span class="st">"MyLake"</span><span class="op">)</span>,</span>
<span>                   depth <span class="op">=</span> <span class="fl">0.9</span>, var <span class="op">=</span> <span class="st">"temp"</span>,</span>
<span>                   boxwhisker <span class="op">=</span> <span class="cn">TRUE</span>, residuals <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/model_ensemble_timeseries_depth.png" width="650px"><img src="../reference/figures/model_ensemble_vertical_depth.png" width="650px"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Take a look at the model fits to the observed data</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">calc_fit</span>(<span class="at">ncdf =</span> <span class="st">"output/ensemble_output.nc"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>         <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"FLake"</span>, <span class="st">"GLM"</span>,  <span class="st">"GOTM"</span>, <span class="st">"Simstrat"</span>, <span class="st">"MyLake"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>         <span class="at">var =</span> <span class="st">"temp"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="sc">$</span>FLake</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>      rmse       nse         r      bias      mae      nmae</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="dv">1</span> <span class="fl">3.353107</span> <span class="fl">0.6522126</span> <span class="fl">0.6448119</span> <span class="sc">-</span><span class="fl">2.048613</span> <span class="fl">2.090902</span> <span class="fl">0.1863813</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="sc">$</span>GLM</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>      rmse       nse         r      bias      mae      nmae</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.671799</span> <span class="fl">0.5899169</span> <span class="fl">0.8976564</span> <span class="sc">-</span><span class="fl">2.078693</span> <span class="fl">2.116857</span> <span class="fl">0.2334367</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="sc">$</span>GOTM</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>      rmse       nse         r      bias      mae      nmae</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.076912</span> <span class="fl">0.7515084</span> <span class="fl">0.9373982</span> <span class="sc">-</span><span class="fl">1.642189</span> <span class="fl">1.691141</span> <span class="fl">0.1990019</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="sc">$</span>Simstrat</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>      rmse       nse         r      bias      mae      nmae</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.517848</span> <span class="fl">0.6347966</span> <span class="fl">0.8378958</span> <span class="sc">-</span><span class="fl">1.237562</span> <span class="fl">1.983922</span> <span class="fl">0.2224387</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="sc">$</span>MyLake</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>      rmse       nse         r      bias      mae      nmae</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.548408</span> <span class="fl">0.6258777</span> <span class="fl">0.9059941</span> <span class="sc">-</span><span class="fl">1.922304</span> <span class="fl">1.958271</span> <span class="fl">0.1946865</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="sc">$</span>ensemble_mean</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>      rmse       nse         r      bias      mae      nmae</span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.385461</span> <span class="fl">0.6721914</span> <span class="fl">0.9118315</span> <span class="sc">-</span><span class="fl">1.781649</span> <span class="fl">1.874828</span> <span class="fl">0.1992386</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Take a look at the model performance against residuals, time and depth</span></span>
<span><span class="va">plist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_resid.html">plot_resid</a></span><span class="op">(</span>ncdf <span class="op">=</span> <span class="va">ens_out</span>,var <span class="op">=</span> <span class="st">"temp"</span>,</span>
<span>                   model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'FLake'</span>, <span class="st">'GLM'</span>,  <span class="st">'GOTM'</span>, <span class="st">'Simstrat'</span>, <span class="st">'MyLake'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/model_ensemble_diagnostics.png" width="450px"></p>
</div>
<div class="section level4">
<h4 id="further-custom-post-processing">Further custom post-processing<a class="anchor" aria-label="anchor" href="#further-custom-post-processing"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load post-processed output data into your workspace</span></span>
<span><span class="va">analyse_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse_ncdf.html">analyse_ncdf</a></span><span class="op">(</span>ncdf <span class="op">=</span> <span class="va">ens_out</span>, model <span class="op">=</span> <span class="va">model</span>, spin_up <span class="op">=</span> <span class="cn">NULL</span>, drho <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Example plot the summer stratification period</span></span>
<span><span class="va">strat_df</span> <span class="op">&lt;-</span> <span class="va">analyse_df</span><span class="op">$</span><span class="va">strat</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">strat_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">TotStratDur</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Total stratification duration [days]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"output/model_ensemble_stratification.png"</span>, <span class="va">p</span>,  dpi <span class="op">=</span> <span class="fl">300</span>, width <span class="op">=</span> <span class="fl">284</span>,</span>
<span>       height <span class="op">=</span> <span class="fl">284</span>, units <span class="op">=</span> <span class="st">"mm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/model_ensemble_stratification.png" width="250px"></p>
</div>
<div class="section level4">
<h4 id="adding-several-model-runs-to-a-single-netcdf-file">Adding several model runs to a single netcdf file<a class="anchor" aria-label="anchor" href="#adding-several-model-runs-to-a-single-netcdf-file"></a>
</h4>
<p>The <code>run_ensemble</code> function allows to add different model
runs to a single netcdf file. This is done by setting the argument
<code>add = TRUE</code>. Only model runs that go over the same time
period and use the same time steps can be combined to a single netcdf
file. Using this functionality e.g. model runs with different
parametrizations can be ran and compared. Many diagnostic functions like
<code>calc_fit</code> or <code>plot_ensemble</code> have two additional
arguments <code>dim</code> and <code>dim_index</code> to select which
dimension should be used. The argument <code>dim</code> can either be
“model” or “member” and <code>dim_index</code> then gives the index of
the other dimension to be used, e.g. if the netcdf file contains 3
different ensemble runs (member) with the two models “FLake” and “GLM”
<code>calc_fit("ncfile.nc", model = c("FLake", "GLM"), dim = "model", dim_index = 2)</code>
calculates the model performance of both model for the second ensemble
run (<code>dim_index = 2</code>). Whereas,<br><code>calc_fit("ncfile.nc", model = c("FLake", "GLM"), dim = "member", dim_index = 2)</code>
calculates the performance of all model runs (members) of the GLM runs
(the second model).</p>
</div>
</div>
<div class="section level3">
<h3 id="model-calibration">Model calibration<a class="anchor" aria-label="anchor" href="#model-calibration"></a>
</h3>
<p>LakeEnsemblR includes some tools for automatic model calibration
which are included in the <code><a href="../reference/cali_ensemble.html">cali_ensemble()</a></code> function. The
function profides three methods:</p>
<ul>
<li>method “LHC”: Lathin hypercube calibration</li>
<li>method “MCMC”: Markov Chain Monte Carlo simulation using the
<code>modMCMC</code> function from the <code>FME</code> package (<span class="citation">Soetaert and Petzoldt (2010)</span>)</li>
<li>method “modFit”: model fitting using one of the algorithms provided
in the <code>modFit</code> function from the <code>FME</code> package
(<span class="citation">Soetaert and Petzoldt (2010)</span>)</li>
</ul>
<p>For details on the structure of the calibration section in the yaml
config file see section 4.11.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">calibration</span><span class="kw">:</span><span class="co">                                   # Calibration section                                   # Calibration section</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="at">   </span><span class="fu">met</span><span class="kw">:</span><span class="co">                                        # Meteo scaling parameter</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="at">      </span><span class="fu">wind_speed</span><span class="kw">:</span><span class="co">                              # Wind speed scaling</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span><span class="co">                            # lower bound for wind speed scaling        </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                              # upper bound for wind speed scaling</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">                            # initial value for wind speed scaling</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                            # log transform scaling factor</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="at">      </span><span class="fu">swr</span><span class="kw">:</span><span class="co">                                     # shortwave radiation scaling</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span><span class="co">                            # lower bound for shortwave radiation scaling</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">1.5</span><span class="co">                            # upper bound for shortwave radiation scaling</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">                            # initial value for shortwave radiation scaling</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                            # log transform scaling factor</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="at">   </span><span class="fu">Simstrat</span><span class="kw">:</span><span class="co">                                # Simstrat specific parameters                                 </span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="at">      </span><span class="fu">a_seiche</span><span class="kw">:</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.0008</span><span class="co">                         # lower bound for parameter</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.003</span><span class="co">                          # upper bound for parameter</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.001</span><span class="co">                        # initial value for parameter</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                            # log transform scaling factor                          </span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="at">   </span><span class="fu">MyLake</span><span class="kw">:</span><span class="co">                                  # MyLake specific parameters                                    </span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="at">     </span><span class="fu">Phys.par/C_shelter</span><span class="kw">:</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="at">        </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.14</span><span class="co">                            # lower bound for parameter</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="at">        </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.16</span><span class="co">                            # upper bound for parameter</span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="at">        </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.15</span><span class="co">                          # initial value for parameter</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="at">        </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                             # log transform scaling factor   </span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="at">   </span><span class="fu">GOTM</span><span class="kw">:</span><span class="co">                                    # GOTM specific parameters</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="at">      </span><span class="fu">turb_param/k_min</span><span class="kw">:</span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">5E-6</span><span class="co">                           # lower bound for parameter</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">5E-4</span><span class="co">                           # upper bound for parameter</span></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">1E-5</span><span class="co">                         # initial value for parameter</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="at">   </span><span class="fu">GLM</span><span class="kw">:</span><span class="co">                               # GLM specific parameters</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="at">      </span><span class="fu">mixing/coef_mix_hyp</span><span class="kw">:</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span><span class="co">                       # lower bound for parameter</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="co">                         # upper bound for parameter</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="co">                       # initial value for parameter</span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span><span class="co">                       # log transform scaling factor</span></span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a><span class="at">   </span><span class="fu">FLake</span><span class="kw">:</span><span class="co">                             # FLake specific parameters</span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a><span class="at">      </span><span class="fu">c_relax_C</span><span class="kw">:</span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a><span class="at">         </span><span class="fu">lower</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.00003</span><span class="co">                  # lower bound for parameter</span></span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a><span class="at">         </span><span class="fu">upper</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span><span class="co">                      # upper bound for parameter</span></span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a><span class="at">         </span><span class="fu">initial</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.003</span><span class="co">                  # initial value for parameter</span></span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a><span class="at">         </span><span class="fu">log</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span><span class="co">                       # log transform scaling factor</span></span></code></pre></div>
<p>The calibration process can then be run using the
<code><a href="../reference/cali_ensemble.html">cali_ensemble()</a></code> function. Methods “LHC” and “MCMC” will
write intermediate results to .csv text files in the folder specified by
the <code>out_f</code> argument. It is possible to parallelize the
calibration procedure using the <code>parallel</code> argument. This
will distribute the calibration of the models to different cores. It is
worth noting that in the current state the bottle neck for the
computation speed is running MyLake (as it is written in R and
significantly slower than the other four models).</p>
<p>You can calibrate any parameter you like. However, as a guideline for
users that are not familiar with some of these models, here are some
model-specific parameters that have been calibrated in previous
studies:</p>
<ul>
<li>FLake: depth_w_lk, extincoef_optic, c_relax_C, fetch_lk,
latitude_lk, depth_bs_lk, T_bs_lk, albedo, initial conditions (<span class="citation">Salgado and Le Moigne (2010)</span>) (<span class="citation">Bernhardt et al. (2012)</span>) (<span class="citation">Layden, MacCallum, and Merchant (2016)</span>)</li>
<li>GLM: meteorological scaling factors (wind_factor, sw_factor,
lw_factor), strmbd_slope, Kw, min_layer_thick, max_layer_thick,
coef_mix_conv, coef_wind_stir, coef_mix_shear, coef_mix_turb,
coef_mix_KH, coef_mix_hyp (<span class="citation">Bueche, Hamilton, and
Vetter (2017)</span>) (<span class="citation">Bruce et al.
(2018)</span>) (<span class="citation">Hipsey et al. (2019)</span>)</li>
<li>GOTM: Scaling factors for heat, wind speed, and shortwave radiation,
k_min, g2 (<span class="citation">Ayala, Moras, and Pierson
(2020)</span>)</li>
<li>Simstrat: a_seiche, f_wind, p_radin, p_albedo, q_nn, c10, cd
(peeters_2002) (<span class="citation">Gaudard et al.
(2019)</span>)</li>
<li>MyLake: (Physical parameters only:) C_shelter, swa_b1 (Less
sensitive: dz and I_scT, and Kz_ak) (<span class="citation">Saloranta
(2006)</span>)</li>
</ul>
<div class="section level4">
<h4 id="lhc-method">LHC method<a class="anchor" aria-label="anchor" href="#lhc-method"></a>
</h4>
<p>The “LHC” method will sample a number of parameter sets definded by
the <code>num</code> argument within the bounds definded by
<code>upper</code> and <code>lower</code> in the master config file. For
each model given in the <code>model</code> argument a set of parameters
consisting of the meteo scaling factors and the model spüecific
parameters will be sampled and the model will be run for each set,
calculating model performance indices for each run. Both the parameter
set and the model results will be written to the <code>out_f</code>
folder. By default the model performance indices are:</p>
<ul>
<li>rmse: root mean squared error</li>
<li>nse: Nash-Sutcliff model efficiency</li>
<li>r: Pearson corelation coefficient</li>
<li>bias: the mean error</li>
<li>nmae: normalized mean absolute error</li>
</ul>
<p>But you can provide your own function to calculate model performances
using the <code>qualfun</code> argument. The provided function must take
the two arguments: observed data, and simulated data, both are
data.frames with first column being datetime and then columns with depth
specific values (lokking like the return value of the
<code><a href="../reference/get_output.html">get_output()</a></code> function).</p>
<p>The function returns a list with an entry for every model, containing
the path to the files containing the parameter sets and the model
performance indices for every model run.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calibrate the </span></span>
<span><span class="fu"><a href="../reference/cali_ensemble.html">cali_ensemble</a></span><span class="op">(</span><span class="va">config_file</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GLM"</span>, <span class="st">"GOTM"</span>, <span class="st">"FLake"</span>, <span class="st">"MyLake"</span>, <span class="st">"Simstrat"</span><span class="op">)</span>,</span>
<span>              cmethod <span class="op">=</span> <span class="st">"LHC"</span>, num <span class="op">=</span> <span class="fl">300</span>, out_f <span class="op">=</span> <span class="st">"calibration"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mcmc-method">MCMC method<a class="anchor" aria-label="anchor" href="#mcmc-method"></a>
</h4>
<p>The “MCMC” method utalizes the <code>modMCMC()</code> function from
the <code>FME</code> package (<span class="citation">Soetaert and
Petzoldt (2010)</span>), using an adaptive Metropolis algorithm and
including a delayed rejection procedure. Internally the function
calculates the sum of squares, which is equivalent to -2 log(likelihood)
for a Gaussian likelihood and prior. The MCMC will run <code>num</code>
evaluations for every model. The outcome of every model call during the
MCMC simulation is written to a model specific file in the
<code>out_f</code> folder, containing the parameter values and the sum
of squares of the residuals. Additional arguments can be supplied to
<code>modMCMC()</code> using the ellipsis argument
(<code>...</code>).</p>
<p>The function returns a list with an entry for every model, containing
the return value of <code>modMCMC()</code> for every model run.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calibrate the </span></span>
<span><span class="fu"><a href="../reference/cali_ensemble.html">cali_ensemble</a></span><span class="op">(</span><span class="va">config_file</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GLM"</span>, <span class="st">"GOTM"</span>, <span class="st">"FLake"</span>, <span class="st">"MyLake"</span>, <span class="st">"Simstrat"</span><span class="op">)</span>,</span>
<span>              cmethod <span class="op">=</span> <span class="st">"MCMC"</span>, num <span class="op">=</span> <span class="fl">3000</span>, out_f <span class="op">=</span> <span class="st">"calibration"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="modfit-method">modFit method<a class="anchor" aria-label="anchor" href="#modfit-method"></a>
</h4>
<p>The “modFit” method utalizes the <code>modFit()</code> function from
the <code>FME</code> package (<span class="citation">Soetaert and
Petzoldt (2010)</span>), Fitting a model to data. Additional arguments
can be supplied to <code>modFit()</code> using the ellipsis argument
(<code>...</code>).</p>
<p>The function returns a list with an entry for every model, containing
the return value of <code>modFit()</code> for every model run.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calibrate the models using a Nelder-Mead algorithm</span></span>
<span><span class="fu"><a href="../reference/cali_ensemble.html">cali_ensemble</a></span><span class="op">(</span><span class="va">config_file</span>, model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GLM"</span>, <span class="st">"GOTM"</span>, <span class="st">"FLake"</span>, <span class="st">"MyLake"</span>, <span class="st">"Simstrat"</span><span class="op">)</span>,</span>
<span>              cmethod <span class="op">=</span> <span class="st">"modFit"</span>, out_f <span class="op">=</span> <span class="st">"calibration"</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="citation">Citation<a class="anchor" aria-label="anchor" href="#citation"></a>
</h2>
<p>See</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"LakeEnsemblR"</span><span class="op">)</span></span></code></pre></div>
<p>on how to cite this project.</p>
<p>Although this information is included when running the function
above, we would like to repeat that in case you use and cite
LakeEnsemblR, you will also need to cite the individual models that you
used in your simulations.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ayala_simulations_gotm_2020" class="csl-entry">
Ayala, Ana I., Simone Moras, and Don C. Pierson. 2020.
<span>“Simulations of Future Changes in Thermal Structure of Lake Erken:
Proof of Concept for ISIMIP2b Lake Sector Local Simulation
Strategy.”</span> <em>Hydrology and Earth System Sciences</em> - (1): –.
<a href="https://doi.org/10.5194/hess-2019-335" class="external-link">https://doi.org/10.5194/hess-2019-335</a>.
</div>
<div id="ref-bernhardt_2012" class="csl-entry">
Bernhardt, Juliane, Christof Engelhardt, Georgiy Kirillin, and Jörg
Matschullat. 2012. <span>“Lake Ice Phenology in Berlin-Brandenburg from
1947–2007: Observations and Model Hindcasts.”</span> Journal Article.
<em>Climatic Change</em> 112 (3-4): 791–817. <a href="https://doi.org/10.1007/s10584-011-0248-9" class="external-link">https://doi.org/10.1007/s10584-011-0248-9</a>.
</div>
<div id="ref-bruce_mlca_glm_2018" class="csl-entry">
Bruce, Louise C., Marieke A. Frassl, George B. Arhonditsis, Gideon Gal,
David P. Hamilton, Paul C. Hanson, Amy L. Hetherington, et al. 2018.
<span>“A Multi-Lake Comparative Analysis of the General Lake Model
(GLM): Stress-Testing Across a Global Observatory Network.”</span>
<em>Environmental Modelling &amp; Software</em> 102 (1): 274–91. <a href="https://doi.org/10.1016/j.envsoft.2017.11.016" class="external-link">https://doi.org/10.1016/j.envsoft.2017.11.016</a>.
</div>
<div id="ref-bueche_2017" class="csl-entry">
Bueche, Thomas, David P. Hamilton, and Mark Vetter. 2017. <span>“Using
the General Lake Model (GLM) to Simulate Water Temperatures and Ice
Cover of a Medium-Sized Lake: A Case Study of Lake Ammersee,
Germany.”</span> Journal Article. <em>Environmental Earth Sciences</em>
76 (13). <a href="https://doi.org/10.1007/s12665-017-6790-7" class="external-link">https://doi.org/10.1007/s12665-017-6790-7</a>.
</div>
<div id="ref-gaudard_toward_2019" class="csl-entry">
Gaudard, Adrien, Love Råman Vinnå, Fabian Bärenbold, Martin Schmid, and
Damien Bouffard. 2019. <span>“Toward an Open Access to High-Frequency
Lake Modeling and Statistics Data for Scientists and Practitioners – the
Case of <span>Swiss</span> Lakes Using <span>Simstrat</span>
V2.1.”</span> <em>Geoscientific Model Development</em> 12 (9): 3955–74.
https://doi.org/<a href="https://doi.org/10.5194/gmd-12-3955-2019" class="external-link">https://doi.org/10.5194/gmd-12-3955-2019</a>.
</div>
<div id="ref-goudsmit_application_2002" class="csl-entry">
Goudsmit, G.-H., H. Burchard, F. Peeters, and A. Wüest. 2002.
<span>“Application of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>−</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">k-\epsilon</annotation></semantics></math>
Turbulence Models to Enclosed Basins: <span>The</span> Role of Internal
Seiches.”</span> <em>Journal of Geophysical Research: Oceans</em> 107
(C12): 23-1-23-13. <a href="https://doi.org/10.1029/2001JC000954" class="external-link">https://doi.org/10.1029/2001JC000954</a>.
</div>
<div id="ref-hipsey_general_2019" class="csl-entry">
Hipsey, M. R., L. C. Bruce, C. Boon, B. Busch, C. C. Carey, D. P.
Hamilton, P. C. Hanson, et al. 2019. <span>“A <span>General</span>
<span>Lake</span> <span>Model</span> (<span>GLM</span> 3.0) for Linking
with High-Frequency Sensor Data from the <span>Global</span>
<span>Lake</span> <span>Ecological</span> <span>Observatory</span>
<span>Network</span> (<span>GLEON</span>).”</span> <em>Geoscientific
Model Development</em> 12 (1): 473–523. <a href="https://doi.org/10.5194/gmd-12-473-2019" class="external-link">https://doi.org/10.5194/gmd-12-473-2019</a>.
</div>
<div id="ref-layden_2016" class="csl-entry">
Layden, Aisling, Stuart N. MacCallum, and Christopher J. Merchant. 2016.
<span>“Determining Lake Surface Water Temperatures Worldwide Using a
Tuned One-Dimensional Lake Model (FLake V1).”</span> Journal Article.
<em>Geoscientific Model Development</em> 9 (6): 2167–89. <a href="https://doi.org/10.5194/gmd-9-2167-2016" class="external-link">https://doi.org/10.5194/gmd-9-2167-2016</a>.
</div>
<div id="ref-mironov_flake_2008" class="csl-entry">
Mironov, Dimitrii V. 2008. <em>Parameterization of Lakes in Numerical
Weather Prediction. Description of a Lake Model</em>. COSMO Technical
Report. Offenbach am Main, Germany: Deutscher Wetterdienst. <a href="http://www.flake.igb-berlin.de/site/doc" class="external-link">http://www.flake.igb-berlin.de/site/doc</a>.
</div>
<div id="ref-salgado_2010" class="csl-entry">
Salgado, Rui, and Patrick Le Moigne. 2010. <span>“Coupling of the FLake
Model to the Surfex Externalized Surface Model.”</span> Journal Article.
<em>Boreal Environmental Research</em> 15: 231–44.
</div>
<div id="ref-saloranta_2006" class="csl-entry">
Saloranta, Tuomo M. 2006. <span>“Highlighting the Model Code Selection
and Application Process in Policy-Relevant Water Quality
Modelling.”</span> Journal Article. <em>Ecological Modelling</em> 194
(1-3): 316–27. <a href="https://doi.org/10.1016/j.ecolmodel.2005.10.031" class="external-link">https://doi.org/10.1016/j.ecolmodel.2005.10.031</a>.
</div>
<div id="ref-saloranta_mylakemulti_year_2007" class="csl-entry">
Saloranta, Tuomo M., and Tom Andersen. 2007.
<span>“<span>MyLake</span>—<span>A</span> Multi-Year Lake Simulation
Model Code Suitable for Uncertainty and Sensitivity Analysis
Simulations.”</span> <em>Ecological Modelling</em>, Uncertainty in
<span>Ecological</span> <span>Models</span>, 207 (1): 45–60. <a href="https://doi.org/10.1016/j.ecolmodel.2007.03.018" class="external-link">https://doi.org/10.1016/j.ecolmodel.2007.03.018</a>.
</div>
<div id="ref-soetaert_inverse_2010" class="csl-entry">
Soetaert, Karline, and Thomas Petzoldt. 2010. <span>“Inverse
<span>Modelling</span>, <span>Sensitivity</span> and <span>Monte</span>
<span>Carlo</span> <span>Analysis</span> in <span>R</span>
<span>Using</span> <span>Package</span> <span>FME</span>.”</span>
<em>Journal of Statistical Software</em> 33 (1): 1–28. <a href="https://doi.org/10.18637/jss.v033.i03" class="external-link">https://doi.org/10.18637/jss.v033.i03</a>.
</div>
<div id="ref-umlauf_gotm_2005" class="csl-entry">
Umlauf, Lars, Karsten Bolding, and Hans Burchard. 2005. <em>GOTM –
Scientific Documentation</em> (version 3.2). Marine Science Reports.
Warnemuende, Germany: Leibniz-Institute for Baltic Sea Research. <a href="https://gotm.net/portfolio/documentation/" class="external-link">https://gotm.net/portfolio/documentation/</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tadhg Moore, Robert Ladwig, Johannes Feldbauer, Jorrit Mesman.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
